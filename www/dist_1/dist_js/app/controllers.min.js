function detectGestures(e){return{restrict:"A",link:function(t,n,o){e.on("swipeup",function(){t.canAnimateSlide=!1,t.slideAnimationMessage=""},n),e.on("swipedown",function(){t.canAnimateSlide=!1,t.slideAnimationMessage=""},n),e.on("pinch",function(){t.canAnimateSlide=!1,t.slideAnimationMessage=""},n),e.on("pinchin",function(){t.canAnimateSlide=!1,t.slideAnimationMessage=""},n),e.on("pinchout",function(){t.canAnimateSlide=!1,t.slideAnimationMessage=""},n),e.on("dragup",function(){t.canAnimateSlide=!1,t.slideAnimationMessage=""},n),e.on("dragdown",function(){t.canAnimateSlide=!1,t.slideAnimationMessage=""},n),e.on("release",function(){t.canAnimateSlide=!0},n)}}}function iframeLoaded(e,t,n){return function(t,o,i){if(t.$last){var a=.6,r=1,s=(document.getElementById("emailScroll"),document.getElementById("emailBody"));s.innerHTML=e("unsafeHtml")(t.email.emailBody);var l=s.getElementsByClassName("unreadAppResize"),u=window.screen.width,c=window.screen.height;if(null!=l[0]&&angular.isDefined(l[0])){var d=(c>l[0].scrollHeight?c:l[0].scrollHeight,l[0].scrollWidth),m=l[0].scrollHeight;a=u/d,r=c/m,d>u&&(n.$getByHandle("detailScroller").zoomBy(a),t.initZoom=a),t.showEmailDSMActionFn()}}}}function transformStr(e){var t,e=e||{},n="";for(t in e)n+=t+"("+e[t]+") ";return n+="translateZ(0)","-webkit-transform: "+n+"; -moz-transform: "+n+"; transform: "+n}function authService(e,t,n,o,i){function a(){return window.Connection?navigator.connection.type==Connection.NONE?!1:!0:window.navigator.onLine}function r(){return window.Connection?navigator.connection.type==Connection.NONE?(n.$broadcast("networkAvailable",!1),!1):!0:(n.$broadcast("networkAvailable",window.navigator.onLine),window.navigator.onLine)}function s(){if(!angular.isUndefined(localStorage.oAuth)&&localStorage.oAuth.length>0){var e=JSON.parse(localStorage.oAuth);return null!=e&&!angular.isUndefined(e)&&e.access_token.length>0?!0:!1}return!1}function l(i,a){var r=t.defer(),s=o.login;return e({method:"POST",url:s,headers:{"Content-Type":"application/x-www-form-urlencoded"},data:"userName="+encodeURIComponent(i)+"&password="+encodeURIComponent(a)+"&grant_type=password"}).success(function(e){if(e.access_token.length>0){e.email=i,e.password=a;var t=new Date;e.expiry=t.setDate(t.getDate()+28),u(e),n.$broadcast("user:loggedIn",e),r.resolve(e)}r.resolve(!1)}).error(function(e){var t={};t.email=i,t.password=a,t.access_token=null,t.error_description="An error has occured in api",null!=e&&(t.error_description=e.error_description),console.log(e),r.resolve(t)}),r.promise}function u(e){localStorage.oAuth="",localStorage.oAuth=JSON.stringify(e)}function c(){return localStorage.removeItem("oAuth"),n.$broadcast("user:loggedOut",!0),!0}function d(){if(!angular.isUndefined(localStorage.oAuth)&&localStorage.oAuth.length>0){var e=JSON.parse(localStorage.oAuth);if(!(e.expiry<Date.now()&&a()))return JSON.parse(localStorage.oAuth);l(e.email,e.password).then(function(e){return JSON.parse(localStorage.oAuth)})}return null}function m(n){var i=h+o.checkEmail+n;console.log(i);var a=t.defer();return e.get(i).success(function(e){a.resolve(e)}).error(function(e){console.log(e),a.resolve(e)}),a.promise}function g(n){var i=h+o.saveMember,r=t.defer();return e({method:"POST",url:i,headers:{"Content-Type":"application/json"},data:n}).success(function(e){r.resolve(e)}).error(function(e){e={isSuccessful:!1,message:"An error has occured please retry again"},a()||(e=n.id<1?{isSuccessful:!1,message:"Please check your internet connection and try again."}:{isSuccessful:!1,message:"",saveToApiLog:!0}),r.resolve(e)}),r.promise}function p(){var n=t.defer(),i=d();if(angular.isUndefined(i)||null==i)n.reject();else{var a=i.member_id,r="Bearer "+i.access_token;console.log(r);var s={"Content-Type":"application/json",Authorization:r},l=h+o.getMemberById.replace("[[mid]]",a);e.get(l,{headers:s}).then(function(e){n.resolve(e.data)},function(e){n.resolve(e.data)})}return n.promise}function f(n){var i=t.defer(),a=h+o.forgotPassword+n;return e.get(a).success(function(e){i.resolve(e)}).error(function(e){e={isSuccessful:!1,message:"An error has occured please retry again"},authService.isNetworkAvailable()||(e={isSuccessful:!1,message:"Please check your internet connection and try again or email to support@unreadapp.com"}),i.resolve(e)}),i.promise}var h=o.url;e.defaults.headers.put={"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET, POST, PUT, DELETE, OPTIONS","Access-Control-Allow-Headers":"Origin,Content-Type, X-Requested-With,Accept"},e.defaults.useXDomain=!0;var v={isAuthenticated:s,logout:c,CheckEmailAddressAvailability:m,SaveMember:g,GetMemberById:p,getoAuth:d,isNetworkAvailable:a,login:l,forgotPassword:f,broadcastNetworkAvailability:r};return v}function dataService(e,t,n,o,i){function a(n){var o=f+envVariables.getCategory+n;console.log(o);var a=t.defer();if(i.isNetworkAvailable())e.get(o).success(function(e){e.isSuccessful=!0,a.resolve(e)}).error(function(e){e={isSuccessful:!1},a.resolve(e)});else{var r={isSuccessful:!1};a.resolve(r)}return a.promise}function r(n,o){var a=t.defer(),r=f+envVariables.getNewsletters.replace("[[pageSize]]",o).replace("[[categoryId]]",n);if(i.isNetworkAvailable())e.get(r).success(function(e){a.resolve(e)}).error(function(e){e={isSuccessful:!1},a.resolve(e)});else{var s={isSuccessful:!1};a.resolve(s)}return a.promise}function s(n){var o=i.getoAuth(),a="Bearer "+o.access_token,r=o.member_id,s={"Content-Type":"application/json",Authorization:a},l=t.defer(),u=f+envVariables.getMemberNewsletterEmails.replace("[[lastSentId]]",n).replace("[[mid]]",r);if(i.isNetworkAvailable())e.get(u,{headers:s}).success(function(e){l.resolve(e)}).error(function(e){e={msg:{isSuccessful:!1}},l.resolve(e)});else{var c={msg:{isSuccessful:!1}};l.resolve(c)}return l.promise}function l(n,o){var a=i.getoAuth(),r="Bearer "+a.access_token,s=a.member_id,l={"Content-Type":"application/json",Authorization:r},u=t.defer(),c=f+envVariables.updateMemberNewsletterEmailStatus.replace("[[mid]]",s).replace("[[emailid]]",n).replace("[[statusid]]",o);if(i.isNetworkAvailable())e.get(c,{headers:l}).success(function(e){u.resolve(e)}).error(function(e){e={isSuccessful:!1,saveToApiLog:!i.isNetworkAvailable()},u.resolve(e)});else{var d={isSuccessful:!1,saveToApiLog:!0};u.resolve(d)}return u.promise}function u(n){var o=i.getoAuth(),a="Bearer "+o.access_token,r=f+envVariables.batchUpdateMemberEmailStatus,s={"Content-Type":"application/json",Authorization:a},l=t.defer();return e({method:"POST",url:r,headers:s,data:n}).success(function(e){console.log(e),l.resolve(e)}).error(function(e){e={isSuccessful:!1,message:"An error has occured please try again"},l.resolve(e)}),l.promise}function c(n,o){var a,r={"Content-Type":"application/json"},s=i.getoAuth();if(null!=s||!angular.isUndefined(s)){var l="Bearer "+s.access_token;r={"Content-Type":"application/json",Authorization:l},a={MemberId:s.member_id,SignupIds:n,NewsletterCategoryId:o}}var u=f+envVariables.saveMemberSignupList,c=t.defer();if(i.isNetworkAvailable())e({method:"POST",url:u,headers:r,data:a}).success(function(e){c.resolve(e)}).error(function(e){e={isSuccessful:!1,saveToApiLog:!i.isNetworkAvailable()},c.resolve(e)});else{var d={isSuccessful:!1,saveToApiLog:!0};c.resolve(d)}return c.promise}function d(){var n=i.getoAuth(),o="Bearer "+n.access_token,a=n.member_id,r={"Content-Type":"application/json",Authorization:o},s=t.defer(),l=f+envVariables.getTrendingNewsletters.replace("[[mid]]",a);if(i.isNetworkAvailable())e.get(l,{headers:r}).success(function(e){s.resolve(e)}).error(function(e){e={msg:{isSuccessful:!1}},s.resolve(e)});else{var u={msg:{isSuccessful:!1}};s.resolve(u)}return s.promise}function m(n){var o=i.getoAuth(),a="Bearer "+o.access_token,r=o.member_id,s={"Content-Type":"application/json",Authorization:a},l=t.defer(),u=f+envVariables.saveNewsletterAsUnsub.replace("[[mid]]",r).replace("[[id]]",n);if(i.isNetworkAvailable())e.get(u,{headers:s}).success(function(e){l.resolve(e)}).error(function(e){e={isSuccessful:!1,saveToApiLog:!i.isNetworkAvailable()},l.resolve(e)});else{var c={isSuccessful:!1,saveToApiLog:!i.isNetworkAvailable()};l.resolve(c)}return l.promise}function g(){var n=i.getoAuth(),o="Bearer "+n.access_token,a=n.member_id,r={"Content-Type":"application/json",Authorization:o},s=t.defer(),l=f+envVariables.getMemberNewsletter.replace("[[mid]]",a);if(i.isNetworkAvailable())e.get(l,{headers:r}).then(function(e){console.log(e),s.resolve(e)},function(e){e={isSuccessful:!1},s.resolve(e)});else{var u={isSuccessful:!1};s.resolve(u)}return s.promise}function p(n){var o=i.getoAuth(),a="Bearer "+o.access_token;n.memberId=o.member_id;var r=f+envVariables.feedback,s={"Content-Type":"application/json",Authorization:a},l=t.defer();return e({method:"POST",url:r,headers:s,data:n}).success(function(e){console.log(e),l.resolve(e)}).error(function(e){console.log(e),e={isSuccessful:!1,message:"An error has occured please retry again"},i.isNetworkAvailable()||(e={isSuccessful:!1,message:"Please check your internet connection and try again or email to support@unreadapp.com"}),l.resolve(e)}),l.promise}var f=envVariables.url;e.defaults.headers.put={"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET, POST, PUT, DELETE, OPTIONS","Access-Control-Allow-Headers":"Origin,Content-Type, X-Requested-With,Accept"},e.defaults.useXDomain=!0;var h;h=o("newsletterCategoryCache",{maxAge:36e5,deleteOnExpire:"aggressive",onExpire:function(e,t){a(!1,1).then(function(t){h.put(e,t)})}});return{getNewsletterCategory:a,getNewsletters:r,getMemberNewsletterEmails:s,updateEmail:l,saveMemberSignupList:c,getTrendingNewsletters:d,saveNewsletterAsUnsub:m,getMemberNewsletter:g,sendFeedback:p,batchUpdateMemberEmailStatus:u}}function sqlLiteService(e,t,n,o,i,a,r,s,l){function u(){null===db&&(db=window.cordova?o.openDB({name:"newsletterDB"}):window.openDatabase("newsletterDB","1","newsletterDB",104857600)),o.execute(db,"CREATE TABLE IF NOT EXISTS member(id integer primary key,email text , firstName text ,lastName text,phone text,mobileNo text,gender text,postalCode text,password ,language text,birthday text)"),o.execute(db,"CREATE TABLE IF NOT EXISTS category(id integer primary key,name text,orderNumber integer,iconName text,syncdate text)"),o.execute(db,"CREATE TABLE IF NOT EXISTS newsletter(id integer primary key,clientId integer,categoryId integer,pointId integer,signupAddress text,domainName text ,imagePath text ,orderNumber integer,syncdate text)"),o.execute(db,"CREATE TABLE IF NOT EXISTS memberNewsletters(id integer primary key,memberId integer,categoryId integer,newsletters text,syncdate text)"),o.execute(db,"CREATE TABLE IF NOT EXISTS newsletterEmail(emailid integer primary key,memberId integer,categoryId integer,newsletterSignupId integer,subject text,fromEmail text ,createdDate text,emailSendingDate text,emailBody text,imagePath text,statusName text,pointforSave integer,pointforNotInterest integer,pointforFeedback integer,pointforShare integer,opened integer)"),o.execute(db,"CREATE TABLE IF NOT EXISTS trendingEmail(emailid integer primary key,memberId integer,categoryId integer,newsletterSignupId integer,subject text,fromEmail text ,createdDate text,emailSendingDate text,emailBody text,imagePath text,statusName text,pointforSave integer,pointforNotInterest integer,pointforFeedback integer,pointforShare integer,opened integer)"),o.execute(db,"CREATE TABLE IF NOT EXISTS ApiFailedLog(id integer primary key AUTOINCREMENT,memberId integer,apiCallType text,dataObject text,created text)")}function c(t){var n=e.defer(),i=!1,a="INSERT INTO member (id , email , firstName ,lastName ,phone ,mobileNo,gender ,postalCode,password ,language,birthday) VALUES (?,?,?,?,?,?,?,?,?,?,?)";return o.execute(db,a,[t.id,t.email,t.firstName,t.lastName,t.phone,t.mobileNo,t.gender,t.postalCode,t.password,t.language,t.birthday]).then(function(e){console.log("INSERT ID -> "+e.insertId),i=!0,n.resolve(i)},function(e){console.log(e),n.resolve(i)}),n.promise}function d(){var t=e.defer(),n=i.getoAuth(),r=n.member_id,l=null,u="SELECT email , firstName ,lastName ,phone ,mobileNo,gender ,postalCode,password ,language,birthday FROM member WHERE id = ?";return o.execute(db,u,[r]).then(function(e){if(e.rows.length>0)l={email:e.rows.item(0).email,firstName:e.rows.item(0).firstName,lastName:e.rows.item(0).lastName,postalCode:e.rows.item(0).postalCode,password:e.rows.item(0).password,phone:e.rows.item(0).phone,province:"",city:"",mobileNo:e.rows.item(0).mobileNo,gender:e.rows.item(0).gender,language:e.rows.item(0).language,birthyear:g(e.rows.item(0).birthday,0),birthmonth:g(e.rows.item(0).birthday,1),birthdate:g(e.rows.item(0).birthday,2),id:r},t.resolve(l);else{i.GetMemberById().then(function(e){console.log("m not available"),angular.isUndefined(e)||null==e?i.logout():c(e).then(function(e){e&&(a.getMemberNewsletter().then(function(e){if(console.log(" nl recvd"),console.log(e),console.log(e.data.memberNewsletterSignupList),angular.isDefined(e.data.memberNewsletterSignupList)&&e.data.memberNewsletterSignupList.length){var t=[];angular.forEach(e.data.memberNewsletterSignupList,function(e){var n=e.newsletterSignupId,o=e.categoryId,i=s("filter")(t,{cId:o},!0);if(!angular.isUndefined(i)&&i.length){var a=t.indexOf(i[0]),r=i[0].nlIds,l=r.indexOf(n);l>-1||r.push(n),i[0].nlIds=r,i[0].nlIds.length<1?t.splice(a,1):t[a]=angular.copy(i[0])}else{var r=[];r.push(n),t.push({cId:o,nlIds:r})}}),console.log(t),x(t,!0)}}),d().then(function(e){console.log(e),t.resolve(e)}))})});console.log("No results found"),t.resolve(l)}},function(e){console.error(e),t.resolve(l)}),t.promise}function m(t){var n=e.defer(),i=!1,a="UPDATE member SET  email=(?) , firstName=(?) ,lastName=(?) ,phone=(?) ,mobileNo=(?),gender=(?) ,postalCode=(?),password=(?) ,language=(?),birthday=(?) WHERE id = (?)";return o.execute(db,a,[t.email,t.firstName,t.lastName,t.phone,t.mobileNo,t.gender,t.postalCode,t.password,t.language,t.birthday,t.id]).then(function(e){i=!0,n.resolve(i)},function(e){n.resolve(i)}),n.promise}function g(e,t){return angular.isUndefined(e)||null==e?null:parseInt(e.split(/-/)[t],10)}function p(t,n){var i=e.defer(),a=null,r="SELECT  id, email ,password  FROM member WHERE email = (?) and password=(?)";return o.execute(db,r,[t,n]).then(function(e){e.rows.length>0?(a={success:!0,email:e.rows.item(0).email,password:e.rows.item(0).password,id:e.rows.item(0).id},i.resolve(a)):(a={success:!1,message:"Email and Password does not match"},i.resolve(a))}),i.promise}function f(n,o){var a=e.defer();return i.isNetworkAvailable()?i.login(n,o).then(function(e){R(),a.resolve(e)},function(e){a.resolve(e)}):p(n,o).then(function(e){if(e.success){var i=new Date;i.setDate(i.getDate()+1);var r={email:n,password:o,access_token:e.id.toString(),member_id:e.id,expiry:i};localStorage.oAuth="",localStorage.oAuth=JSON.stringify(r),t.$broadcast("user:loggedIn",e),R(),a.resolve(r)}else{var r={email:n,password:o,access_token:"",error_description:"The internet is disconnected on your device.Connect to internet and try again"};R(),a.resolve(r)}}),a.promise}function h(){o.execute(db,"CREATE INDEX IF NOT EXISTS _indexUniqueId  ON newsletter (categoryId)").then(function(){},function(e){console.log(e)}),o.execute(db,"CREATE INDEX IF NOT EXISTS _indexUniqueStatus  ON newsletterEmail (statusName)").then(function(){},function(e){console.log(e)}),o.execute(db,"CREATE INDEX IF NOT EXISTS _indexUniqueMemberId  ON newsletterEmail (memberId)").then(function(){},function(e){console.log(e)})}function v(){h();var t=e.defer(),n=[],i=!0,a="SELECT id ,name,orderNumber,iconName,syncdate FROM category",r=Math.floor(Date.now()/1e3);return o.execute(db,a).then(function(e){i=e.rows.length>0?r-e.rows.item(0).syncdate<1e4?!0:!1:!0}),console.log(i),i?w(!0).then(function(o){if(null!=o){var i=o.categories,a=1;angular.forEach(i,function(o,r){E(o.id,!0).then(function(o){n.push(!0),a==i.length&&(e.all(n),t.resolve(!0)),a++},function(e){console.log(e)})})}else t.resolve(!1)}):(n.push(!0),e.all(n),t.resolve(!0)),t.promise}function b(t){var n=e.defer(),i=[];return angular.forEach(t,function(e){var t=(new Date,Math.floor(Date.now()/1e3)),a="INSERT INTO category (id ,name,orderNumber,iconName,syncdate) VALUES (?,?,?,?,?)";o.execute(db,a,[e.id,e.name,e.orderNumber,e.iconName,t]).then(function(e){console.log("INSERT ID -> "+e.insertId),i.push(!0)},function(e){console.log(e),n.resolve(!0)})}),e.all(i),n.resolve(!0),n.promise}function w(t){var n=[],i=e.defer(),a=null,r="SELECT id ,name,orderNumber,iconName,syncdate FROM category",s=Math.floor(Date.now()/1e3);return o.execute(db,r).then(function(e){if(e.rows.length>0)if(t)if(s-e.rows.item(0).syncdate<1e4){console.log("hours do  match");for(var o=0;o<e.rows.length;o++){var r=e.rows.item(o);n.push(r)}a={categories:n},i.resolve(a)}else console.log("hours do not match"),I(1).then(function(e){e?w(!1).then(function(e){i.resolve(e)}):i.resolve(a)});else{for(var o=0;o<e.rows.length;o++){var r=e.rows.item(o);n.push(r)}a={categories:n},i.resolve(a)}else console.log("No records in Db"),I(1).then(function(e){console.log(e),e?w(!1).then(function(e){console.log(e),i.resolve(e)}):i.resolve(a)})},function(e){console.log(e),i.resolve(a)}),i.promise}function I(t){var n=e.defer(),i=!0;return a.getNewsletterCategory(t).then(function(e){console.log(e),angular.isUndefined(e.categories)||null==e||!e.isSuccessful?(console.log("No data is available gh"),i=!1,n.resolve(i)):(1===t&&o.execute(db,"delete from category"),b(e.categories).then(function(t){e.currentPage<e.totalPages?I(e.currentPage+1):(i=!0,n.resolve(i))}))}),n.promise}function S(t){var n=e.defer(),i=null,a="SELECT id ,name,orderNumber,iconName,syncdate FROM category where id=(?)";Math.floor(Date.now()/1e3);return o.execute(db,a,[t]).then(function(e){e.rows.length>0&&(i=e.rows.item(0),n.resolve(i))},function(e){console.log(e),n.resolve(i)}),n.promise}function E(t,n){var i=e.defer(),a=null,r="SELECT id,clientId,categoryId ,pointId,signupAddress,domainName,imagePath,orderNumber,syncdate FROM newsletter WHERE categoryId = (?) ORDER BY orderNumber";return o.execute(db,r,[t]).then(function(e){if(e.rows.length>0){var o=Math.floor(Date.now()/1e3),r=[];if(n)if(o-e.rows.item(0).syncdate<5e4){console.log("hours do  match");for(var s=0;s<e.rows.length;s++){var l=e.rows.item(s);r.push(l)}a={newsletterSignup:r},i.resolve(a)}else console.log("hours do not match"),A(t).then(function(e){e&&E(t,!1).then(function(e){i.resolve(e)})});else{for(var s=0;s<e.rows.length;s++){var l=e.rows.item(s);r.push(l)}a={newsletterSignup:r},i.resolve(a)}}else console.log("No records in Db"),A(t).then(function(e){e?E(t,!1).then(function(e){i.resolve(e)}):i.resolve(e)})},function(e){console.log(e),i.resolve(a)}),i.promise}function y(t,n,o){var i=e.defer(),a=null,r=[];return D(t,n,o,!1).then(function(e){null!=e&&(r=e),null!=o&&o.length>0&&o.length<11?D(t,n,o,!0).then(function(e){null!=e?(angular.forEach(e,function(e){r.push(e)}),a={newsletterSignup:r},i.resolve(a)):(a={newsletterSignup:r},i.resolve(a))}):(a={newsletterSignup:r},i.resolve(a))},function(e){i.resolve(a)}),i.promise}function D(t,n,i,a){var r=e.defer(),s=null,l="SELECT id,clientId,categoryId ,pointId,signupAddress,domainName,imagePath,orderNumber,syncdate FROM newsletter ";return t>0&&(l=l+" WHERE categoryId ="+t),null!=i&&i.length>0&&(l+=t>0?" And ":" where ",l=a?l+" id not  in ("+i+")":l+" id in ("+i+")"),l+=t>0?" ORDER BY orderNumber ":" ORDER BY imagePath ",n>0&&(l=l+" Limit "+n),o.execute(db,l).then(function(e){if(e.rows.length>0){for(var t=[],n=0;n<e.rows.length;n++){var o=e.rows.item(n);t.push(o)}s=t,r.resolve(s)}else console.log("No records in Db"),r.resolve(s)},function(e){console.log(e),r.resolve(s)}),r.promise}function N(t){var n=e.defer(),i=[];return angular.forEach(t,function(e){var t=(new Date,Math.floor(Date.now()/1e3)),n="INSERT INTO newsletter (id ,clientId ,categoryId ,pointId ,signupAddress ,domainName ,imagePath,orderNumber ,syncdate) VALUES (?,?,?,?,?,?,?,?,?)";o.execute(db,n,[e.id,e.clientId,e.categoryId,e.pointId,e.signupAddress,e.domainName,e.imagePath,e.orderNumber,t]),i.push(!0)}),e.all(i),n.resolve(!0),n.promise}function A(t){var n=e.defer(),i=!0;return a.getNewsletters(t,1e3).then(function(e){if(!angular.isUndefined(e.newsletterSignup)&&e.newsletterSignup.length>0){var a="delete  from newsletter where categoryId=(?)";o.execute(db,a,[t]),N(e.newsletterSignup).then(function(e){i=!0,n.resolve(i)})}else n.resolve(i)}),n.promise}function x(t,n){var a=e.defer(),r=i.getoAuth(),s=r.member_id;if(n){var l="DELETE FROM memberNewsletters WHERE memberId = (?)";o.execute(db,l,[s]).then(function(){console.log("deleted")})}if(angular.isUndefined(t))a.resolve(!0);else{var u=[],c=Math.floor(Date.now()/1e3);angular.forEach(t,function(e){var t="INSERT INTO memberNewsletters (memberId ,categoryId ,newsletters ,syncdate) VALUES (?,?,?,?)";o.execute(db,t,[s,e.cId,e.nlIds,c]).then(function(){},function(e){console.log(e)}),u.push(!0)}),e.all(u),a.resolve(!0)}return a.promise}function C(t,n){var a=e.defer(),r=i.getoAuth(),s=r.member_id;if(angular.isUndefined(t))a.reject();else{var l="DELETE FROM memberNewsletters WHERE memberId =(?) AND categoryId = (?)";o.execute(db,l,[s,n]);var u=[],c=Math.floor(Date.now()/1e3);if(t.length>0){var d="INSERT INTO memberNewsletters (memberId ,categoryId ,newsletters ,syncdate) VALUES (?,?,?,?)";o.execute(db,d,[s,n,t,c])}u.push(!0),e.all(u),a.resolve(!0)}return a.promise}function T(t){var n=e.defer(),a=i.getoAuth(),r=a.member_id,s=[],l="SELECT newsletters FROM memberNewsletters WHERE memberId = (?)";return t>0?(l="SELECT newsletters FROM memberNewsletters WHERE memberId =(?) AND categoryId = (?)",o.execute(db,l,[r,t]).then(function(e){if(e.rows.length>0){for(var t=e.rows.item(0),o=t.newsletters,i=o.split(",").map(function(e){return Number(e)}),a=0;a<i.length;a++)s.push(i[a]);n.resolve(s)}else n.resolve(s)},function(e){n.resolve(s)})):o.execute(db,l,[r]).then(function(e){if(e.rows.length>0){for(var t=0;t<e.rows.length;t++)for(var o=e.rows.item(t).newsletters,i=o.split(",").map(function(e){return Number(e)}),a=0;a<i.length;a++)s.push(i[a]);n.resolve(s)}else n.resolve(s)},function(e){console.log(e),n.resolve(s)}),n.promise}function $(){var t=e.defer(),n=i.getoAuth(),a=n.member_id,r=[],s="SELECT categoryId,newsletters FROM memberNewsletters WHERE memberId = (?)";return o.execute(db,s,[a]).then(function(e){for(var n=0;n<e.rows.length;n++){var o=e.rows.item(n),i=o.newsletters,a=i.split(",").map(function(e){return Number(e)});r.push({cId:o.categoryId,nlIds:a})}t.resolve(r)},function(e){console.log(e),t.resolve(r)}),t.promise}function M(t,n){var a=e.defer(),r=i.getoAuth(),s=r.member_id,l={result:!1},u="SELECT categoryId,newsletters FROM memberNewsletters WHERE memberId = (?) AND  categoryId = (?)";return o.execute(db,u,[s,n]).then(function(e){if(e.rows.length>0){var n=e.rows.item(0).newsletters,o=n.split(",").map(function(e){return Number(e)});o.indexOf(t)>-1?(l={result:!0},a.resolve(l)):a.resolve(l)}else a.resolve(l)},function(e){console.log(e),a.resolve(l)}),a.promise}function F(){var t=e.defer(),n=i.getoAuth();if(!angular.isUndefined(n)&&n.member_id>0){var a=n.member_id,r=0,s="SELECT emailid  FROM newsletterEmail WHERE memberId = (?)ORDER BY emailid DESC LIMIT 1";o.execute(db,s,[a]).then(function(e){e.rows.length>0&&(r=e.rows.item(0).emailid),O(r).then(function(e){e?t.resolve(r):t.resolve(0)})},function(e){console.log(e),t.resolve(r)})}else t.resolve(r);return t.promise}function O(t){var n=e.defer(),i=[];return a.getMemberNewsletterEmails(t).then(function(t){t.msg.isSuccessful&&t.memberNewsletterEmailList.length>0?(angular.forEach(t.memberNewsletterEmailList,function(e){var t="INSERT INTO newsletterEmail(emailid ,memberId ,categoryId ,newsletterSignupId ,subject ,fromEmail  ,createdDate ,emailSendingDate ,emailBody ,imagePath ,statusName ,pointforSave ,pointforNotInterest ,pointforFeedback ,pointforShare,opened ) VALUES (?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)";o.execute(db,t,[e.emailid,e.memberId,e.categoryId,e.newsletterSignupId,e.subject,e.fromEmail,e.createdDate,e.emailSendingDate,e.emailBody,e.imagePath,e.statusName,e.pointforSave,e.pointforNotInterest,e.pointforFeedback,e.pointforShare,0]).then(function(e){i.push(!0)},function(e){console.log(e),i.push(!0)})}),e.all(i),n.resolve(!0)):n.resolve(!1)}),n.promise}function k(n,a,r){var s=e.defer(),l=null,u=i.getoAuth(),c=[],d=10*(a-1);if(d=isNaN(d)?0:d,!angular.isUndefined(u)&&u.member_id>0){var m=u.member_id,g="select statusName,count(*)  total from newsletterEmail WHERE memberId = (?)  AND opened=0 group by statusName";o.execute(db,g,[m]).then(function(e){if(e.rows.length>0)for(var n=0;n<e.rows.length;n++)"Inbox"===e.rows.item(n).statusName&&t.$broadcast("UnreadCount",e.rows.item(n).total),"Save"===e.rows.item(n).statusName&&t.$broadcast("UnreadCountSaved",e.rows.item(n).total)},function(e){console.log(e)});var p="SELECT emailid ,emailBody,memberId ,categoryId ,newsletterSignupId ,subject ,fromEmail  ,createdDate ,emailSendingDate,imagePath ,statusName ,pointforSave ,pointforNotInterest ,pointforFeedback ,pointforShare ,opened FROM newsletterEmail WHERE memberId = (?) AND statusName = (?) ";r>0&&(p=p+"And emailId < "+r),p=p+"  ORDER BY emailid DESC  LIMIT 10 OFFSET "+d,o.execute(db,p,[m,n]).then(function(e){if(e.rows.length>0){for(var t=0;t<e.rows.length;t++){var n=e.rows.item(t);c.push(n)}l=c,s.resolve(l)}else s.resolve(l)},function(e){console.log(e),s.resolve(l)})}else s.resolve(l);return s.promise}function U(t,n){var a=e.defer(),r=null,s=i.getoAuth(),l=[];if(!angular.isUndefined(s)&&s.member_id>0){var u=s.member_id;R();var c="SELECT emailid,emailBody ,memberId ,categoryId ,newsletterSignupId ,subject ,fromEmail  ,createdDate ,emailSendingDate,imagePath ,statusName ,pointforSave ,pointforNotInterest ,pointforFeedback ,pointforShare FROM newsletterEmail WHERE memberId = (?) AND statusName = (?) ";n>0&&(c=c+"And emailId > "+n),c+="  ORDER BY emailid  ",o.execute(db,c,[u,t]).then(function(e){if(e.rows.length>0){for(var t=0;t<e.rows.length;t++){var n=e.rows.item(t);l.push(n)}r=l,a.resolve(r)}else a.resolve(r)},function(e){console.log(e),a.resolve(r)})}else a.resolve(r);return a.promise}function L(t,n){var a=i.getoAuth(),r="Inbox";2===n&&(r="Save"),3===n&&(r="Delete");var s=e.defer(),l=!1;if(null!=a){var u=(a.member_id,"UPDATE newsletterEmail SET statusName=(?)  WHERE emailid = (?)");o.execute(db,u,[r,t]).then(function(e){l=!0,R(),s.resolve(l)},function(e){s.resolve(l)})}return s.promise}function R(){var e=i.getoAuth();if(null!=e){var n=e.member_id,a="select count(*)  total from newsletterEmail WHERE memberId = (?)  AND opened=0  And statusName='Inbox'";o.execute(db,a,[n]).then(function(e){e.rows.length>0?t.$broadcast("UnreadCount",e.rows.item(0).total):t.$broadcast("UnreadCount",0)},function(e){console.log(e)});var r="select count(*)  total from newsletterEmail WHERE memberId = (?)  AND opened=0  And statusName='Save'";o.execute(db,r,[n]).then(function(e){e.rows.length>0?t.$broadcast("UnreadCountSaved",e.rows.item(0).total):t.$broadcast("UnreadCountSaved",0)},function(e){console.log(e)})}else t.$broadcast("UnreadCount",0),t.$broadcast("UnreadCountSaved",0)}function B(){var t=e.defer(),n=i.getoAuth(),r=n.member_id;return a.getTrendingNewsletters().then(function(e){if(!angular.isUndefined(e)&&e.msg.isSuccessful&&e.memberNewsletterEmailList.length>0){var n="DELETE from trendingEmail where memberId=(?)";o.execute(db,n,[r]),angular.forEach(e.memberNewsletterEmailList,function(e){var t="INSERT INTO trendingEmail(emailid ,memberId ,categoryId ,newsletterSignupId ,subject ,fromEmail  ,createdDate ,emailSendingDate ,emailBody ,imagePath ,statusName ,pointforSave ,pointforNotInterest ,pointforFeedback ,pointforShare,opened ) VALUES (?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)";o.execute(db,t,[e.emailid,e.memberId,e.categoryId,e.newsletterSignupId,e.subject,e.fromEmail,e.createdDate,e.emailSendingDate,e.emailBody,e.imagePath,e.statusName,e.pointforSave,e.pointforNotInterest,e.pointforFeedback,e.pointforShare,0]).then(function(e){},function(e){console.log(e)})}),t.resolve(!0)}else t.resolve(!0)}),t.promise}function P(t){var n=e.defer(),a=null,r=i.getoAuth(),s=[];if(!angular.isUndefined(r)&&r.member_id>0){var l=r.member_id,u="SELECT emailid ,memberId ,categoryId ,newsletterSignupId ,subject ,fromEmail  ,createdDate ,emailSendingDate ,emailBody ,imagePath ,statusName ,pointforSave ,pointforNotInterest ,pointforFeedback ,pointforShare,opened FROM trendingEmail WHERE memberId = (?) ORDER BY emailid DESC ";o.execute(db,u,[l]).then(function(e){if(e.rows.length>0){for(var o=0;o<e.rows.length;o++){var i=e.rows.item(o);s.push(i)}a=s,n.resolve(a)}else t?B().then(function(e){e?P(!1).then(function(e){n.resolve(e)}):n.resolve(a)}):n.resolve(a)},function(e){console.log(e),n.resolve(!1)})}return n.promise}function j(t,n){var a=e.defer(),r=null,s=0,l=i.getoAuth(),u=l.member_id,c="SELECT emailid ,memberId ,categoryId ,newsletterSignupId ,subject ,fromEmail  ,createdDate ,emailSendingDate ,emailBody ,imagePath ,statusName ,pointforSave ,pointforNotInterest ,pointforFeedback ,pointforShare FROM newsletterEmail WHERE memberId = (?) AND emailid=(?) AND statusName = (?) ORDER BY emailid DESC ",d="SELECT emailid ,memberId ,categoryId ,newsletterSignupId ,subject ,fromEmail  ,createdDate ,emailSendingDate ,emailBody ,imagePath ,statusName ,pointforSave ,pointforNotInterest ,pointforFeedback ,pointforShare FROM newsletterEmail WHERE memberId = (?)  AND emailid < (?)  AND statusName = (?)ORDER BY emailid DESC LIMIT 1",m=[u,t,n];return"Trending"===n&&(c="SELECT emailid ,memberId ,categoryId ,newsletterSignupId ,subject ,fromEmail  ,createdDate ,emailSendingDate ,emailBody ,imagePath ,statusName ,pointforSave ,pointforNotInterest ,pointforFeedback ,pointforShare FROM trendingEmail WHERE memberId = (?)  AND emailid=(?) ",d="SELECT emailid ,memberId ,categoryId ,newsletterSignupId ,subject ,fromEmail  ,createdDate ,emailSendingDate ,emailBody ,imagePath ,statusName ,pointforSave ,pointforNotInterest ,pointforFeedback ,pointforShare  FROM trendingEmail WHERE memberId = (?)  AND emailid < (?) ORDER BY emailid DESC LIMIT 1",m=[u,t]),o.execute(db,c,m).then(function(e){e.rows.length>0?o.execute(db,d,m).then(function(t){s=t.rows.length>0?t.rows.item(0):null,r={email:e.rows.item(0),prevEmail:s},a.resolve(r)},function(e){console.log(e),a.resolve(r)}):a.resolve(r)},function(e){console.log(e),a.resolve(r)}),a.promise}function _(t){var n=e.defer(),a=null,r=i.getoAuth(),s=r.member_id,l="SELECT emailBody  FROM newsletterEmail WHERE memberId = (?) AND emailid=(?)  ORDER BY emailid DESC ",u=[s,t];return"Trending"===status&&(l="SELECT emailBody  FROM trendingEmail WHERE memberId = (?)  AND emailid=(?) "),o.execute(db,l,u).then(function(e){e.rows.length>0?(a={emailBody:e.rows.item(0).emailBody},n.resolve(a)):n.resolve(a)},function(e){console.log(e),n.resolve(a)}),n.promise}function H(t,n){var a=e.defer(),r=!1,s=i.getoAuth(),l=s.member_id,u="SELECT * FROM memberNewsletters WHERE memberId = (?)  AND  categoryId = (?)";return o.execute(db,u,[l,n]).then(function(e){if(e.rows.length>0){var i=e.rows.item(0).newsletters;if(i.indexOf(t)>-1){var s=i.split(",").map(function(e){return Number(e)}),u=s.indexOf(t);s.splice(u,1);var c="UPDATE memberNewsletters  set newsletters =(?) WHERE memberId = (?)  AND  categoryId = (?)";o.execute(db,c,[s,l,n]).then(function(e){r=!0,a.resolve(r)},function(e){console.log(e)})}else r=!0,a.resolve(r)}else r=!0,a.resolve(r)},function(e){console.log(e),a.resolve(r)}),a.promise}function V(){var t=e.defer(),n=i.getoAuth(),a=0,r="SELECT count(*) Total  FROM newsletterEmail WHERE memberId = (?)";return o.execute(db,r,[n.member_id]).then(function(e){e.rows.length>0?(a=e.rows.item(0).Total,t.resolve(a)):t.resolve(a)},function(e){console.log(e),t.resolve(a)}),t.promise}function W(t,n){var a=e.defer(),r=i.getoAuth(),s="Update newsletterEmail set opened =1  WHERE memberId = (?) AND emailid=(?) AND statusName = '"+n+"' And opened=0 ";return"Trending"===n&&(s="Update trendingEmail set opened =1  WHERE memberId = (?) AND emailid=(?)  And opened=0 "),
o.execute(db,s,[r.member_id,t]).then(function(e){a.resolve(!0)},function(e){console.log(e),a.resolve(!0)}),R(),a.promise}function q(t,n){var a=e.defer(),r=null,s=i.getoAuth(),l=s.member_id,u=[],c=[],d="SELECT * from(SELECT emailid ,memberId ,categoryId ,newsletterSignupId ,subject ,fromEmail  ,createdDate ,emailSendingDate,imagePath ,statusName ,pointforSave ,pointforNotInterest ,pointforFeedback ,pointforShare ,opened , 2 rank FROM newsletterEmail WHERE memberId = "+l+"  AND statusName = '"+n+"' And ( Lower(subject) LIKE '%"+t.toLowerCase()+"%'   )";return d=d+" UNION SELECT emailid ,memberId ,categoryId ,newsletterSignupId ,subject ,fromEmail  ,createdDate ,emailSendingDate,imagePath ,statusName ,pointforSave ,pointforNotInterest ,pointforFeedback ,pointforShare ,opened , 1 rank  FROM newsletterEmail WHERE memberId = "+l+"  AND statusName = '"+n+"' And (  Lower(fromEmail) LIKE '%"+t.toLowerCase()+"%'   )",d=d+" UNION SELECT emailid ,memberId ,categoryId ,newsletterSignupId ,subject ,fromEmail  ,createdDate ,emailSendingDate,imagePath ,statusName ,pointforSave ,pointforNotInterest ,pointforFeedback ,pointforShare ,opened , 3 rank  FROM newsletterEmail WHERE memberId = "+l+"  AND statusName = '"+n+"' And (  Lower(emailBody) LIKE '%"+t.toLowerCase()+"%' ) ) ORDER BY rank ",o.execute(db,d).then(function(e){if(e.rows.length>0)for(var t=0;t<e.rows.length;t++){var n=e.rows.item(t);c.indexOf(n.emailid)<0&&(u.push(n),c.push(n.emailid))}r=u,a.resolve(r)},function(e){console.log(e),r=u,a.resolve(r)}),a.promise}function z(t,n){var a=e.defer(),r=null,s=i.getoAuth(),l=s.member_id,u=[],c="SELECT emailid ,memberId ,categoryId ,newsletterSignupId ,subject ,fromEmail  ,createdDate ,emailSendingDate,imagePath ,statusName ,pointforSave ,pointforNotInterest ,pointforFeedback ,pointforShare ,opened FROM newsletterEmail WHERE memberId = (?) AND statusName = (?)  AND categoryId=(?)";return o.execute(db,c,[l,t,n]).then(function(e){if(e.rows.length>0){for(var t=0;t<e.rows.length;t++){var n=e.rows.item(t);u.push(n)}r=u,a.resolve(r)}else a.resolve(r)},function(e){console.log(e),a.resolve(r)}),a.promise}function J(e){if(!angular.isUndefined(e)){var t=i.getoAuth(),n=t.member_id,a="INSERT INTO ApiFailedLog (memberId ,apiCallType ,dataObject ,created) VALUES (?,?,?,?)";o.execute(db,a,[n,e.apiCallType,e.dataObject,new Date]).then(function(e){console.log("INSERT ID -> "+e.insertId)},function(e){console.log(e)})}}function Y(){var e=i.getoAuth(),t=e.member_id,n="DELETE FROM ApiFailedLog WHERE id=(?)",r="SELECT id,memberId ,apiCallType ,dataObject ,created FROM ApiFailedLog WHERE memberId = (?) AND apiCallType = (?)ORDER BY created DESC LIMIT 1";o.execute(db,r,[t,"profile"]).then(function(e){e.rows.length>0&&i.SaveMember(JSON.parse(e.rows.item(0).dataObject)).then(function(t){if(t.isSuccessful){var i=e.rows.item(0).id;o.execute(db,n,[i]).then(function(){},function(e){console.log(e)})}})},function(e){console.log(e)});var s="SELECT id,memberId ,apiCallType ,dataObject ,created FROM ApiFailedLog WHERE memberId = (?) AND apiCallType = (?)ORDER BY created ";o.execute(db,s,[t,"sub"]).then(function(e){if(e.rows.length>0)for(var n=0;n<e.rows.length;n++){var i=e.rows.item(n),r=JSON.parse(i.dataObject);if(a.saveMemberSignupList(r.signupIds,r.cId).then(),n==e.rows.length-1){var s="Delete FROM ApiFailedLog WHERE memberId = (?) AND apiCallType = (?)";o.execute(db,s,[t,"sub"]).then(function(e){},function(e){console.log(e)})}}},function(e){console.log(e)});var l="SELECT id,memberId ,apiCallType ,dataObject ,created FROM ApiFailedLog WHERE memberId = (?) AND apiCallType = (?)",u=[];o.execute(db,l,[t,"emailStatusChange"]).then(function(e){if(e.rows.length>0){for(var n=0;n<e.rows.length;n++){var i=JSON.parse(e.rows.item(n).dataObject);u.push({Emailid:i.Emailid,StatusId:i.StatusId})}if(u.length>0){var r={MemberId:t,EmailStatusList:u};a.batchUpdateMemberEmailStatus(r).then(function(e){if(e.isSuccessful){var n="DELETE FROM ApiFailedLog WHERE memberId = (?) AND apiCallType = (?)";o.execute(db,n,[t,"emailStatusChange"]).then(function(e){},function(e){console.log(e)})}})}}},function(e){console.log(e)});o.execute(db,l,[t,"notInterested"]).then(function(e){if(e.rows.length>0)for(var n=0;n<e.rows.length;n++){var i=e.rows.item(n);if(a.saveNewsletterAsUnsub(i.dataObject).then(function(e){}),n==e.rows.length-1){var r="Delete FROM ApiFailedLog WHERE memberId = (?) AND apiCallType = (?)";o.execute(db,r,[t,"notInterested"]).then(function(e){},function(e){console.log(e)})}}},function(e){console.log(e)})}function G(){if(i.isNetworkAvailable()){var e=i.getoAuth();if(null!=e&&!angular.isUndefined(e)){var t=e.member_id,n=0,a="SELECT count(*) as total  FROM ApiFailedLog WHERE memberId = (?)";o.execute(db,a,[t]).then(function(e){if(e.rows.length>0&&(n=e.rows.item(0).total,!angular.isUndefined(localStorage.oAuth)&&localStorage.oAuth.length>0)){var t=JSON.parse(localStorage.oAuth);t.access_token==t.member_id?i.login(t.email,t.password).then(function(){n>0&&Y()}):n>0&&Y()}})}}}u(),G();return{setMemberTODeviceDB:c,getMemberFromDeviceDB:d,updateMemberToDeviceDB:m,getNewsLetterCategoriesFromDeviceDB:w,getNewsletterFromDeviceDB:E,getNewslettersFromDeviceDB:y,insertMemberNewsletterToDeviceDB:x,updateMemberNewsletterToDeviceDB:C,getMemberNewslettersFromDeviceDB:T,getMemberNewsletterCategoryIdsFromDeviceDB:$,syncMemberEmailsToDeviceDB:F,getEmailsFromDeviceDB:k,updateEmailToDeviceDB:L,getTrendingEmailFromDeviceDB:P,getEmailDetailfromDeviceDB:j,getCategoryFromDeviceDB:S,saveNewsletterAsUnsubFromDeviceDb:H,initNewsletterCategory:v,login:f,InsertIntoApiFailedLog:J,ProcessApiFailedLog:Y,getEmailCount:V,getEmailBodyfromDeviceDB:_,search:q,getNewEmailsFromDeviceDB:U,markAsRead:W,veirfySubscribed:M,getEmailsByCategory:z}}function passwordMatch(){function e(e,t,n,o){t.bind("blur",function(i){if(o&&t.val()){var a=document.getElementById("password"),r=a.value;if(r&&!(r.length<1)){var s=(e.$eval(n.passwordMatch),t[0].value);r===s?o.$setValidity("passwordMatch",!0):(console.log("f"),o.$setValidity("passwordMatch",!1))}}}),t.bind("focus",function(e){o.$setValidity("passwordMatch",!0)})}var t={restrict:"A",require:"ngModel",link:e};return t}function checkEmail(e){function t(t,n,o,i){n.bind("blur",function(a){if(i&&n.val()){var r=(t.$eval(o.checkEmail),n.val());e.CheckEmailAddressAvailability(r).then(function(e){r==n.val()&&null!=e&&i.$setValidity("checkEmail",!e.isSuccessful)},function(){i.$setValidity("checkEmail",!0)})}}),n.bind("focus",function(e){t.vm.signupForm.email.$setValidity("checkEmail",!0)})}var n={restrict:"A",require:"ngModel",link:t};return n}var db=null;!function(){"use strict";function e(e,t,n,o,i,a,r,s,l){e.ready(function(){ionic.Platform.isFullScreen=!0,window.cordova&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!1)),window.StatusBar&&StatusBar.styleDefault(),db=window.cordova?a.openDB({name:"newsletterDB"}):window.openDatabase("newsletterDB","1","newsletterDB",104857600)}),o.$on("$stateChangeStart",function(e,o,i,a,r){o.authRequired&&!t.isAuthenticated()&&(n.transitionTo("app.home"),e.preventDefault())}),o.$on("$ionicView.enter",function(){s.canDragContent(!1)}),window.cordova&&setTimeout(function(){l.hide()},3e3)}function t(e,t,n){e.state("app",{url:"/app","abstract":!0,templateUrl:"app/menu/menu.html"}).state("app.login",{url:"/login?:email",views:{menuContent:{templateUrl:"app/login/login.html"}}}).state("app.forgotPassword",{url:"/forgotPassword/:email",views:{menuContent:{templateUrl:"app/forgotPassword/forgotPassword.html"}}}).state("app.signup",{url:"/signup?:email",views:{menuContent:{templateUrl:"app/signup/signup.html"}}}).state("app.profile",{url:"/profile",authRequired:!0,views:{menuContent:{templateUrl:"app/profile/profile.html"}}}).state("app.profileThankYou",{url:"/profileThankYou",authRequired:!0,views:{menuContent:{templateUrl:"app/profile/profileThankYou.html"}}}).state("app.home",{url:"/home",views:{menuContent:{templateUrl:"app/home/home.html"}}}).state("app.inbox",{url:"/inbox",authRequired:!0,views:{menuContent:{templateUrl:"app/inbox/inbox.html"}}}).state("app.saved",{url:"/saved",authRequired:!0,views:{menuContent:{templateUrl:"app/saved/saved.html"}}}).state("app.trending",{url:"/trending",authRequired:!0,views:{menuContent:{templateUrl:"app/trending/trending.html"}}}).state("app.about",{url:"/about",authRequired:!0,views:{menuContent:{templateUrl:"app/about/about.html"}}}).state("app.settings",{url:"/settings",authRequired:!0,views:{menuContent:{templateUrl:"app/settings/settings.html"}}}).state("app.splash",{url:"/splash",authRequired:!0,views:{menuContent:{templateUrl:"app/splash/splash.html"}}}).state("app.feedback",{url:"/feedback",authRequired:!0,views:{menuContent:{templateUrl:"app/feedback/feedback.html"}}}).state("app.search",{url:"/search/:status?:category",authRequired:!0,views:{menuContent:{templateUrl:"app/search/search.html"}}}).state("app.notification",{url:"/notification",authRequired:!0,views:{menuContent:{templateUrl:"app/notification/notification.html"}}}).state("app.subscription",{url:"/subscription",authRequired:!0,views:{menuContent:{templateUrl:"app/subscription/subscription.html"}}}).state("app.subscription-category",{url:"/subscription-category/:id",authRequired:!0,views:{menuContent:{templateUrl:"app/subscription/subscription-category.html"}}}),t.otherwise("app/splash")}e.$inject=["$ionicPlatform","authService","$state","$rootScope","$ionicPopup","$cordovaSQLite","$cordovaNetwork","$ionicSideMenuDelegate","$cordovaSplashscreen"],t.$inject=["$stateProvider","$urlRouterProvider","$ionicConfigProvider"],angular.module("newsletterApp",["ionic","ngMessages","ngAnimate","ngCordova","angular-cache","ionic.service.core","ionic.service.push"]).run(e).config(t).constant("envVariables",envVariables)}();var envVariables={dbName:"newsletterDB",url:"http://tools-stg1.wiredmessenger.com/WmNewsletterSignupApp/api/",login:"http://tools-stg1.wiredmessenger.com/WmNewsletterSignupApp/token",checkEmail:"Member/CheckEmailAddressAvailability?emailaddress=",checkUsername:"Member/CheckUserNameAvailability?username=",getCategory:"Newsletter/GetCategoryList?searchPhrase&status=1&lowerBound=1&upperBound=100&pageSize=100&sortBy=OrderAsc&pageNum=",getNewsletters:"Newsletter/GetNewsletterSignupList?status=1&lowerBound=1&upperBound=1000&pageSize=[[pageSize]]&pageNum=1&sortBy=OrderAsc&categoryId=[[categoryId]]",saveMember:"Member/SaveMember",saveMemberSignupList:"Member/SaveMemberSignupList",getMemberNewsletterEmails:"Member/GetMemberNewsletterEmails?lastSentId=[[lastSentId]]&memberId=[[mid]]",getMemberById:"Member/GetMemberById?memberId=[[mid]]",getTrendingNewsletters:"Member/GetTrendingNewsletters?memberId=[[mid]]",updateMemberNewsletterEmailStatus:"Member/UpdateMemberNewsletterEmailStatus?memberId=[[mid]]&emailId=[[emailid]]&statusId=[[statusid]]",saveNewsletterAsUnsub:"Member/SaveNewsletterAsUnsub?memberId=[[mid]]&signupId=[[id]]",getMemberNewsletter:"Member/GetMemberNewsletter?memberId=[[mid]]",feedback:"Member/SendFeedBack",batchUpdateMemberEmailStatus:"Member/BatchUpdateMemberEmailStatus",forgotPassword:"Member/ForgotPassword?email="};!function(){"use strict";function e(e,t,n,o,i,a,r,s,l,u,c,d,m,g,p,f){function h(t){s(function(){t==e.undoEmailId&&(e.showUndo=!1,e.undoStatus=0,e.undoEmailId=0)},4e3)}e.emailSlide=[],e.email,e.prevEmail,e.openFeedback=!1,e.share=!1,e.emailStatus=!1,e.showUndo=!1,e.undoStatus=0,e.undoEmailId=0,e.undoMessage="",e.showNotInterestedMessage=!1,e.showloader_det=!0,e.slideAnimationMessage="",e.modalOpened=!0,e.subscribed=!0,e.feedback={},e.feedbackError=!1,e.showTutorialOverlay=!1,e.modifiedEmails=[],e.readEmails=[],e.canAnimateSlide=!0,e.showEmailDSMAction=!0,e.initZoom=.6,e.openPopover=function(t){e.popover.show(t)},e.closePopover=function(){e.popover.hide()},i.fromTemplateUrl("app/detail/detail.html",{scope:e,animation:"fade-in"}).then(function(t){e.modal=t}),e.openModal=function(t,n){e.readEmails.push(t),e.modalOpened=!0,e.emailStatus=n,o.getEmailDetailfromDeviceDB(t,n).then(function(t){e.prevEmail=t.prevEmail,e.email=t.email,e.emailSlide=[],e.emailSlide.push({email:e.email,prevEmail:e.prevEmail}),console.log(e.emailSlide),e.PopulatePopOverTemplate(),e.showloader_det=!1,o.markAsRead(e.email.emailid,e.emailStatus),angular.isUndefined(localStorage.showTutorialOverlayDetail)&&(e.showTutorialOverlay=!0)}),e.modal.show()},e.closeModal=function(){e.modifiedEmails.length&&e.$parent.vm.updateEmailFromModal(e.modifiedEmails),"Trending"!=e.emailStatus&&e.$parent.vm.updateCssFromModal(e.readEmails),e.modalOpened=!1,e.email="",e.prevEmail="",e.emailSlide=[],e.modal.hide()},e.$on("$destroy",function(){e.modal.remove()}),e.toogleShare=function(){e.share=!e.share},e.emailDSMAction=function(n,i,a){e.showEmailDSMAction=!1,o.updateEmailToDeviceDB(n,i).then(function(r){r&&(e.undoStatus=0,e.undoEmailId=e.email.emailid,e.showUndo=!1,"Save"===e.emailStatus&&(e.undoStatus=2),"Inbox"===e.emailStatus&&(e.undoStatus=1),e.undoMessage="",e.undoMessage=2===i?"1 item moved to saved.":3===i?"1 item deleted.":"1 item moved to Inbox",e.modifiedEmails.indexOf(n)<0&&e.modifiedEmails.push(n),t.updateEmail(n,i).then(function(e){if(!e.isSuccessful&&e.saveToApiLog){var t={Emailid:n,StatusId:i},a={apiCallType:"emailStatusChange",dataObject:JSON.stringify(t)};o.InsertIntoApiFailedLog(a)}}),e.openFeedback=!1,e.share=!1,e.getNextEmail(a))})},e.notInterested=function(n){var n=e.email.newsletterSignupId;e.openFeedback=!1,e.share=!1,o.saveNewsletterAsUnsubFromDeviceDb(n,e.email.categoryId).then(function(){t.saveNewsletterAsUnsub(n).then(function(e){if(!e.isSuccessful){var t=({Emailid:n,StatusId:status},{apiCallType:"notInterested",dataObject:n.toString()});o.InsertIntoApiFailedLog(t)}}),e.closePopover(),e.showNotInterestedMessage=!0,s(function(){e.showNotInterestedMessage=!1},5e3)})},e.sendFeedback=function(){e.closePopover();var n=new Date,o=e.email.newsletterSignupId+"#[email] has send feedback for [brand]  "+e.email.subject+".  Feedback send on "+n.toLocaleDateString(),i=' <label ><div class="input-label"> Description</div><textarea rows="3" class="popup-feedback-textarea" name="description" placeholder="Please enter your feedback or comment."  id="description"  ng-model="feedback.Description" ></textarea></label><div class="form-error" ng-if="feedbackError">Please enter the description.</div>';c.confirm({template:i,title:"Feedback",scope:e,buttons:[{text:"Cancel"},{text:"<b>Submit</b>",type:"button-positive",onTap:function(n){if(e.feedback.Description){e.feedbackError=!1;var i={Type:"Feedback for particular email",Description:e.feedback.Description,Subject:o};console.log(i),t.sendFeedback(i).then(function(e){e.isSuccessful})}else e.feedbackError=!0,n.preventDefault()}}]}).then(function(e){})},e.getNextEmail=function(t){var n=null!=e.prevEmail?e.prevEmail.emailid:0;n>0?(e.email=e.prevEmail,e.emailSlide=[],e.emailSlide.push({email:e.prevEmail,prevEmail:e.prevEmail}),console.log(e.emailSlide),e.openFeedback=!1,e.share=!1,o.getEmailDetailfromDeviceDB(n,e.emailStatus).then(function(t){e.prevEmail=t.prevEmail,e.emailSlide[0].prevEmail=t.prevEmail,console.log(e.emailSlide),o.markAsRead(e.email.emailid,e.emailStatus),e.PopulatePopOverTemplate(),"Trending"!=e.emailStatus&&(e.showUndo=!0,h(e.undoEmailId))}),e.readEmails.push(n)):(h(e.email.emailid),s(function(){e.closeModal()},3e3))},e.onSlide=function(t){e.slideAnimationMessage="",0===t&&"Inbox"===e.email.statusName?e.emailDSMAction(e.email.emailid,2,t):2===t&&"Trending"!=e.email.statusName?e.emailDSMAction(e.email.emailid,3,t):0===t&&"Save"===e.email.statusName?e.emailDSMAction(e.email.emailid,1,t):e.getNextEmail(t)},e.undoPreviousAction=function(){e.showUndo=!1,e.undoEmailId>0&&e.undoStatus>0&&(e.showEmailDSMAction=!1,o.updateEmailToDeviceDB(e.undoEmailId,e.undoStatus).then(function(n){t.updateEmail(e.undoEmailId,e.undoStatus).then(function(e){}),e.undoStatus=0,o.getEmailDetailfromDeviceDB(e.undoEmailId,e.emailStatus).then(function(t){null!=t.prevEmail&&(e.prevEmail=t.prevEmail),e.email=t.email,e.emailSlide=[],e.emailSlide.push({email:e.email,prevEmail:e.prevEmail}),e.modifiedEmails.indexOf(e.undoEmailId)>-1&&e.modifiedEmails.splice(e.modifiedEmails.indexOf(e.undoEmailId),1),e.showEmailDSMAction=!0})}))},e.PopulatePopOverTemplate=function(){var t='<ion-popover-view class="fit"> <ion-content> <div class="list"><div ng-click="sendFeedback()" class="item item-icon-left"><i class="icon ion-reply-all"></i> Feedback</div>';"Trending"!=e.emailStatus&&(t+=' <div ng-click="notInterested()" class="item item-icon-left"> <i class="icon ion-thumbsdown"></i>Unsubscribe</div>'),"Save"===e.emailStatus&&(t=t+'<div  ng - click = "emailDSMAction('+e.email.emailid,'1)" class="item item-icon-left"><i class = "icon ion-email" > < / i >Move to Inbox'),t+="</div> </ion-content></ion-popover-view>",e.popover=l.fromTemplate(t,{scope:e}),e.closePopover=function(){e.popover.hide()},e.$on("$destroy",function(){e.popover.remove()})},e.animateSlide=function(t){if(e.canAnimateSlide&&"Trending"!=e.emailStatus)if(e.showSlideLeftAnimation=!0,1==t){var n="Save"==e.emailStatus?"Inbox":"Save",o='<div class="animated fadeIn swipe-overlay-save"><div  class="row inbox-save-swipe"><div class="col text-left"><span class="swipe-icon-box"><i class="icon ion-star custom-icon"></i>'+n+"</span></div></div></div>";e.slideAnimationMessage=a.trustAsHtml(o)}else 2==t?e.slideAnimationMessage=a.trustAsHtml('<div  class="animated fadeIn swipe-overlay-delete"><div  class="row inbox-delete-swipe">   <div class="col text-right"><span class="swipe-icon-box"><i class="icon ion-trash-b custom-icon"></i>Delete</span></div></div></div>'):e.slideAnimationMessage=""},e.closeTutorialOverlay=function(){e.showTutorialOverlay=!1,localStorage.showTutorialOverlayDetail="false"},e.zoomTap=function(){e.slideAnimationMessage=""},e.showEmailDSMActionFn=function(){e.showEmailDSMAction=!0},u.onHardwareBackButton(function(){e.modifiedEmails.length&&e.$parent.vm.updateEmailFromModal(e.modifiedEmails),"Trending"!=e.emailStatus&&e.$parent.vm.updateCssFromModal(e.readEmails),e.modalOpened=!1,e.email="",e.prevEmail="",e.emailSlide=[],e.modal.hide()},400)}angular.module("newsletterApp").controller("detailController",e),e.$inject=["$scope","dataService","authService","sqlLiteService","$ionicModal","$sce","$window","$timeout","$ionicPopover","$ionicPlatform","$ionicPopup","$rootScope","$ionicHistory","$state","$ionicSlideBoxDelegate","$ionicScrollDelegate"]}(),detectGestures.$inject=["$ionicGesture"],angular.module("newsletterApp").directive("detectGestures",detectGestures),iframeLoaded.$inject=["$filter","$compile","$ionicScrollDelegate"],angular.module("newsletterApp").directive("iframeLoaded",iframeLoaded),function(){"use strict";function e(e,t,n,o,i){function a(){var e=ionic.Platform.device();console.log(e)}t.broadcastNetworkAvailability();var r=this;r.feedbackFormData=[],r.submitted=!1,r.showloading=!1,a(),r.feedbackformSubmit=function(t){if(r.submitted=!0,!t){r.showloading=!0;var o={Type:r.feedbackFormData.type,Description:r.feedbackFormData.description,Subject:r.feedbackFormData.type};e.sendFeedback(o).then(function(e){e.isSuccessful&&(r.submitted=!1,r.feedbackFormData=[],r.feedbackForm.$setUntouched()),r.showloading=!1;var t=e.isSuccessful?"Success":"Failed",o=e.isSuccessful?"Your feedback has been successfully sent.":e.message;n.confirm({title:t,content:o,buttons:[{text:"Close",type:"button-positive"}]}).then(function(e){})},function(e){r.showloading=!1})}}}angular.module("newsletterApp").controller("feedbackController",e),e.$inject=["dataService","authService","$ionicPopup","$window","$scope"]}(),angular.module("newsletterApp").filter("timeAgo",["$filter",function(e){return function(t,n,o){if(!t)return"never";n||(n=Date.now());var i=new Date(t),a=i.getTime()+6e4*i.getTimezoneOffset(),r=-5,s=new Date(a+r);if(t=s.getTime(),angular.isDate(n)?n=n.getTime():"string"==typeof n&&(n=new Date(n).getTime()),"number"==typeof t&&"number"==typeof n){var l=Math.abs((n-t)/1e3),u=[],c=60,d=3600,m=86400,g=604800,p=31556926,f=315569260;return u=c>=l?"now":60*c>l?e("date")(t,"h:mm a"):24*d>l?e("date")(t,"h:mm a"):7*m>l?e("date")(t,"MMM dd"):52*g>l?e("date")(t,"MMM dd"):10*p>l?e("date")(t,"mediumDate"):100*f>l?e("date")(t,"mediumDate"):["","a long time"],u[1]+=0===u[0]||u[0]>1?"s":"",o===!0?u:n>=t?u+" ":" "+u}}}]),angular.module("newsletterApp").filter("trimSubject",function(){return function(e){if(angular.isDefined(e)){var t=e.substring(0,e.lastIndexOf("<"));return(angular.isUndefined(t)||t.length<1)&&(t=e),angular.isUndefined(t)?e:t}return e}}),angular.module("newsletterApp").filter("unsafeHtml",["$sce",function(e){return function(t){if(t.indexOf("<style")>-1){var n=t.split("<style")[1].split("</style>")[0];null==n||angular.isUndefined(n)||(t=t.replace(n," [newcss]"),n=n.replace(/a{/g,".EmailContent a "),n=n.replace(/p{/g,".EmailContent p "),n=n.replace(/img{/g,".EmailContent img "),n=n.replace(/h1/g,".EmailContent h1 "),n=n.replace(/h2/g,".EmailContent h2 "),n=n.replace(/h3/g,".EmailContent h3 "),n=n.replace(/h4/g,".EmailContent h4 "),n=n.replace(/strong/g,".EmailContent strong "),n=n.replace(/b{/g,".EmailContent b "),n=n.replace(/li{/g,".EmailContent li "),n=n.replace(/ul{/g,".EmailContent ul "),n=n.replace(/span{/g,".EmailContent span "),n=n.replace(/ol{/g,".EmailContent ol "),n=n.replace(/body{/g,".EmailContent body "),n=n.replace(/html{/g,".EmailContent html "),n=n.replace(/table{/g,".EmailContent table "),n=n.replace(/td{/g,".EmailContent td "),n=n.replace(/th{/g,".EmailContent th "),n=n.replace(/tr{/g,".EmailContent tr "),n=n.replace(/.button{/g,".EmailContent .button "),n=n.replace(/div{/g,".EmailContent div"),n=n.replace(/@media/g,".EmailContent@media"),t=t.replace("[newcss]",n))}t.indexOf("<table")>-1?t=t.replace("<table",'<table class="unreadAppResize"'):t.indexOf("<div")>-1&&(t=t.replace("<div",'<div id="unreadAppResize"'));var o=/href="([\S]+)"/g,i=t.toString().replace(o,"onClick=\"window.parent.open('$1', '_system', 'location=yes')\"");return e.trustAsHtml(i)}}]),function(){"use strict";function e(e,t,n,o,i){function a(){angular.isDefined(s)&&s.length&&(r.forgotPasswordFormData.email=s)}e.broadcastNetworkAvailability();var r=this,s=o.email;console.log(s),r.forgotPasswordFormData=[],r.forgotPasswordFormData.email,r.submitted=!1,r.FailedMessage,r.showloading=!1,a(),r.forgotPasswordformSubmit=function(o){r.submitted=!0,o||(r.showloading=!0,e.forgotPassword(r.forgotPasswordFormData.email).then(function(e){r.showloading=!1,e.isSuccessful?(r.submitted=!1,t.confirm({title:"Success",content:"Your password has been sent to your email.",buttons:[{text:"Close",type:"button-positive"}]}).then(function(e){n.go("app.login",{email:r.forgotPasswordFormData.email})})):r.FailedMessage=e.message},function(e){}))},r.goback=function(){r.forgotPasswordForm.$setUntouched(),r.submitted=!1,i.nextViewOptions({historyRoot:!0}),n.go("app.login",{email:r.forgotPasswordFormData.email})}}angular.module("newsletterApp").controller("forgotPasswordController",e),e.$inject=["authService","$ionicPopup","$state","$stateParams","$ionicHistory"]}(),function(){"use strict";function e(e,t,n,o,i){function a(){n.isAuthenticated()?(o.nextViewOptions({historyRoot:!0}),e.go("app.inbox")):angular.isUndefined(localStorage.FirstTimeUser)&&null==localStorage.FirstTimeUser||(o.nextViewOptions({historyRoot:!0}),e.go("app.login"))}var r=this;a(),r.gotoLogin=function(){o.nextViewOptions({historyRoot:!0}),e.go("app.signup")},r.gotoNextSlide=function(){i.next()},r.slideChange=function(t){e.go("app.signup")}}angular.module("newsletterApp").controller("homeController",e),e.$inject=["$state","$scope","authService","$ionicHistory","$ionicSlideBoxDelegate"]}(),function(){"use strict";function e(e,t,n,o,i,a,r,s,l,u,c,d){function m(){angular.isUndefined(localStorage.showTutorialOverlay)&&(h.showTutorialOverlay=!0),o.getNewsLetterCategoriesFromDeviceDB(!1).then(function(e){null===e||angular.isUndefined(e.categories)?console.log("No data is available"):h.category=e.categories})}function g(){h.moreItemsAvailable=!0,h.pageNumber=0,h.inboxItems=[],h.lastId=0,h.populateNewsletters().then(function(e){o.syncMemberEmailsToDeviceDB().then(function(e){e>0&&o.getNewEmailsFromDeviceDB("Inbox",e).then(function(e){!angular.isUndefined(e)&&null!=e&&e.length&&angular.forEach(e,function(e){h.inboxItems.unshift(e)})})})})}function p(){l(function(){h.showUndoInbox=!1,h.undoEmailIdInbox=0},3e3)}function f(){o.getEmailCount().then(function(e){h.defaultImg=e>0?"img/newsletter/default_not_first.png":"img/newsletter/default_inbox.png"})}n.broadcastNetworkAvailability();var h=this;h.selectedCategory="",h.category=[],h.showSearchTextBox=!1,h.searchText,h.activeslide=1,h.inboxItems=[],h.swipedToSave=[],h.pageNumber=0,h.moreItemsAvailable=!1,h.showUndoInbox=!1,h.showUndoInbox=!1,h.undoEmail={},h.undoEmailIdInbox=0,h.undoMessageInbox="",h.showTutorialOverlay=!1,h.showloader=!0,h.defaultImg="",h.showDefaultImage=!1,h.canrefresh=!0,h.viewMoreLoader=!1,h.pullRefreshText=n.isNetworkAvailable()?"Pull to refresh...":"Network unavailable",h.lastId=0,h.UnreadCount=0,m(),h.populateNewsletters=function(){var t=e.defer();return h.pageNumber=h.pageNumber+1,h.inboxItems.length<1&&(h.moreItemsAvailable=!0),h.moreItemsAvailable&&(h.moreItemsAvailable=!1,h.pageNumber>1&&(h.viewMoreLoader=!0),o.getEmailsFromDeviceDB("Inbox",h.pageNumber,h.lastId).then(function(e){if(!angular.isUndefined(e)&&null!=e&&e.length){h.showDefaultImage=!1;var n=1;angular.forEach(e,function(t){h.inboxItems.push(t),1==h.inboxItems.length&&(h.lastId=t.emailid),n==e.length&&(h.viewMoreLoader=!1,h.showloader=!1,h.showDefaultImage=!1,h.moreItemsAvailable=!0,s.$broadcast("scroll.infiniteScrollComplete")),n++}),f()}else h.moreItemsAvailable=!1,h.viewMoreLoader=!1,h.showloader=!1,s.$broadcast("scroll.infiniteScrollComplete");0==h.inboxItems.length&&(h.moreItemsAvailable=!1,h.showDefaultImage=!0,f()),t.resolve(!0)},function(e){s.$broadcast("scroll.infiniteScrollComplete"),h.viewMoreLoader=!1,h.showloader=!1,t.resolve(!1)})),t.promise},s.$on("$ionicView.enter",function(){h.selectedCategory="",g(),h.checkForNewEmails()}),h.onSlide=function(e,n){h.undoEmailIdInbox=e;var i=0;0===n?(i=2,h.undoMessageInbox="1 item moved to saved."):(i=3,h.undoMessageInbox="1 item deleted."),r.canDragContent(!1),o.updateEmailToDeviceDB(e,i).then(function(n){n&&(t.updateEmail(e,i).then(function(t){if(!t.isSuccessful&&t.saveToApiLog){var n={Emailid:e,StatusId:i},a={apiCallType:"emailStatusChange",dataObject:JSON.stringify(n)};o.InsertIntoApiFailedLog(a)}}),h.removeEmail(e))}),h.showUndoInbox=!0,p()},h.removeEmail=function(e){var t=a("filter")(h.inboxItems,{emailid:e},!0);if(t.length){var n=h.inboxItems.indexOf(t[0]);h.inboxItems.splice(n,1),h.undoEmail=t[0]}h.inboxItems.length<10&&h.populateNewsletters(),h.inboxItems.length<1&&(h.showDefaultImage=!0)},h.doRefresh=function(){h.canrefresh&&n.isAuthenticated()?(h.canrefresh=!1,o.syncMemberEmailsToDeviceDB().then(function(e){e>0?o.getNewEmailsFromDeviceDB("Inbox",e).then(function(e){!angular.isUndefined(e)&&null!=e&&e.length?(angular.forEach(e,function(e){h.selectedCategory>0&&e.categoryId==h.selectedCategory?h.inboxItems.unshift(e):(0===h.selectedCategory||""===h.selectedCategory)&&h.inboxItems.unshift(e)}),h.showDefaultImage=!1,h.canrefresh=!0,s.$broadcast("scroll.refreshComplete")):(h.canrefresh=!0,s.$broadcast("scroll.refreshComplete"))},function(e){h.canrefresh=!0,s.$broadcast("scroll.refreshComplete")}):(h.canrefresh=!0,s.$broadcast("scroll.refreshComplete"))})):s.$broadcast("scroll.refreshComplete")},h.categoryChanged=function(){var e=h.selectedCategory;e.length>0?(h.pageNumber=0,h.inboxItems=[],h.moreItemsAvailable=!1,h.lastId=0,o.getEmailsByCategory("Inbox",e).then(function(e){!angular.isUndefined(e)&&null!=e&&e.length?(angular.forEach(e,function(e){h.inboxItems.push(e)}),h.showDefaultImage=!1):h.showDefaultImage=!0})):g()},h.undoPreviousActionInbox=function(){h.showUndoInbox=!1,h.undoEmailIdInbox>0&&o.updateEmailToDeviceDB(h.undoEmailIdInbox,1).then(function(e){h.inboxItems.push(h.undoEmail),h.showUndoInbox=!1,h.undoEmailIdInbox=0,h.showDefaultImage=!1,t.updateEmail(h.undoEmailIdInbox,1).then(function(e){})})},h.closeTutorialOverlay=function(){h.showTutorialOverlay=!1,localStorage.showTutorialOverlay="false"},h.gotosearch=function(){u.nextViewOptions({historyRoot:!0}),c.transitionTo("app.search",{status:"Inbox"})},s.$on("UnreadCount",function(e,t){h.UnreadCount=t}),h.checkForNewEmails=function(){n.isAuthenticated()&&l(function(){h.doRefresh(),h.checkForNewEmails()},3e4)},h.updateEmailFromModal=function(e){angular.forEach(e,function(e){h.removeEmail(e)})},h.updateCssFromModal=function(e){angular.forEach(e,function(e){var t="email"+e,n=document.getElementById(t);null!=n&&(n.style.backgroundColor="#eee")})}}angular.module("newsletterApp").controller("inboxController",e),e.$inject=["$q","dataService","authService","sqlLiteService","$ionicPopover","$filter","$ionicSideMenuDelegate","$scope","$timeout","$ionicHistory","$state","$ionicScrollDelegate"]}(),function(){"use strict";function e(e,t,n,o,i,a,r,s,l,u,c){function d(){e.isAuthenticated()&&(i.nextViewOptions({historyRoot:!0}),n.transitionTo("app.inbox"))}function m(){g.loginData=[],g.loginForm.$setUntouched(),g.submitted=!1,g.loginFailed=!1,g.loginFailedMessage=""}e.broadcastNetworkAvailability();var g=this;g.loginData=[],g.submitted=!1,g.loginFailedMessage,g.showloading=!1,g.showbackbutton=!0,g.scrolled=!1;var p=c.email;g.loginData.email=p,d(),g.doLogin=function(e){g.submitted=!0,e?g.loginFailed=!1:(g.showloading=!0,t.login(g.loginData.email,g.loginData.password).then(function(e){g.showloading=!1,null!=e.access_token&&e.access_token.length>0?(t.getMemberFromDeviceDB(),i.nextViewOptions({historyRoot:!0}),n.go("app.inbox",{},{reload:!0})):(g.showloading=!1,g.loginFailed=!0,g.loginFailedMessage=e.error_description)}))},u.$on("$stateChangeSuccess",function(e,t,n,o,i){"app.signup"===o.name?g.showbackbutton=!0:g.showbackbutton=!1}),g.goback=function(){m(),i.nextViewOptions({historyRoot:!0}),event.preventDefault(),n.go("app.signup")},g.gotoSignUp=function(){if(e.isNetworkAvailable()){var t=angular.isUndefined(g.loginData.email)?"":g.loginData.email;m(),i.nextViewOptions({historyRoot:!0}),event.preventDefault(),n.go("app.signup",{email:t})}else e.broadcastNetworkAvailability()},g.gotoForgotPassword=function(){if(g.showloading=!1,e.isNetworkAvailable()){var t=angular.isUndefined(g.loginData.email)?"":g.loginData.email;m(),i.nextViewOptions({historyRoot:!0}),n.go("app.forgotPassword",{email:t})}else e.broadcastNetworkAvailability()},g.scrolltop=function(){g.loginFailedMessage="",l.scrollBy(0,40,!0)},o.$on("$ionicView.beforeEnter",function(e,t){g.loginFailedMessage="",g.showloading=!1})}angular.module("newsletterApp").controller("loginController",e),e.$inject=["authService","sqlLiteService","$state","$scope","$ionicHistory","$window","$cordovaNetwork","$ionicPopup","$ionicScrollDelegate","$rootScope","$stateParams"]}(),function(){"use strict";function e(e,t,n,o,i,a){var r=this;r.loginData=[],r.autenticated=!1,r.UnreadSavedCount=0,r.UnreadCount=0,i.showInternetNotAvailable=!1,r.doLogout=function(){e.logout(),n.location.reload(!0)},e.isAuthenticated()&&(r.autenticated=!0),o.$on("user:loggedIn",function(e,t){r.autenticated=!0}),o.$on("user:loggedOut",function(e,n){r.autenticated=!1,t.transitionTo("app.login")}),e.broadcastNetworkAvailability(),o.$on("UnreadCountSaved",function(e,t){r.UnreadSavedCount=t}),o.$on("UnreadCount",function(e,t){r.UnreadCount=t}),o.$on("networkAvailable",function(e,t){t||(i.showInternetNotAvailable=!0,a(function(){i.showInternetNotAvailable=!1},2e3))}),i.$on("$cordovaNetwork:offline",function(e,t){i.showInternetNotAvailable=!0,a(function(){i.showInternetNotAvailable=!1},2e3)})}angular.module("newsletterApp").controller("menuController",e),e.$inject=["authService","$state","$window","$scope","$rootScope","$timeout"]}(),function(){"use strict";function e(e,t,n,o){
t.$on("$cordovaPush:tokenReceived",function(t,n){alert("Successfully registered token "+n.token),console.log("Ionic Push: Got token ",n.token,n.platform),e.token=n.token}),e.identifyUser=function(){alert("s");var t=n.get();t.user_id||(t.user_id=n.generateGUID()),angular.extend(t,{name:"shivani",bio:"Developer at wiredmessenger"}),n.identify(t).then(function(){e.identified=!0,console.log("Identified user "+t.name+"\n ID "+t.user_id)})},e.pushRegister=function(){console.log("Ionic Push: Registering user"),o.register({canShowAlert:!0,canSetBadge:!0,canPlaySound:!0,canRunActionsOnWake:!0,onNotification:function(e){return console.log("true"),!0}})}}angular.module("newsletterApp").controller("notificationController",e),e.$inject=["$scope","$rootScope","$ionicUser","$ionicPush"]}(),function(){"use strict";function e(e,t,n,o,i,a,r,s,l){function u(){n.getMemberFromDeviceDB().then(function(e){c.signupData=e})}var c=this;c.submitted=!1,c.signupData=[],c.showloading=!1,c.errorMessage,c.showThankYou=!1,c.year=(new Date).getFullYear(),c.maxyear=c.year-13,c.minyear=c.year-150,e.broadcastNetworkAvailability(),l.$on("$ionicView.enter",function(){u()}),c.signFormsubmit=function(t){c.validateDate(),c.submitted=!0,t||c.errorMessage.length>0||(c.showloading=!0,c.signupData.birthday=c.signupData.birthyear+"-"+c.signupData.birthmonth+"-"+c.signupData.birthdate,n.updateMemberToDeviceDB(c.signupData).then(function(t){t&&e.SaveMember(c.signupData).then(function(e){if(e.isSuccessful)c.showloading=!1,s.confirm({title:"Success",content:"Thank you for keeping your profile up to date.",buttons:[{text:"Close",type:"button-positive"}]}).then(function(e){});else if(c.showloading=!1,c.errorMessage=e.message,e.message.length<1){if(!angular.isUndefined(e.saveToApiLog)&&e.saveToApiLog){var t={memberId:c.signupData.id,apiCallType:"profile",dataObject:JSON.stringify(c.signupData)};n.InsertIntoApiFailedLog(t)}s.confirm({title:"Success",content:"Thank you for keeping your profile up todate.",buttons:[{text:"Close",type:"button-positive"}]}).then(function(e){})}})}))},c.validateDate=function(){return(4==c.signupData.birthmonth||6==c.signupData.birthmonth||9==c.signupData.birthmonth||11==c.signupData.birthmonth)&&c.signupData.birthdate>=31?void(c.errorMessage="Please enter valid birth date"):(c.errorMessage="",void(c.signupData.birthmonth>0&&c.signupData.birthdate>0&&(2==c.signupData.birthmonth&&c.signupData.birthdate>29?c.errorMessage="Please enter valid birth date":c.errorMessage="")))},l.$on("$locationChangeStart",function(e,t,n){c.signupForm.$setUntouched(),c.submitted=!1})}angular.module("newsletterApp").controller("profileController",e),e.$inject=["authService","dataService","sqlLiteService","$state","$ionicHistory","$filter","$q","$ionicPopup","$scope"]}(),function(){"use strict";function e(e,t,n,o,i,a,r,s,l){function u(){angular.isUndefined(localStorage.showTutorialOverlay)&&(d.showTutorialOverlay=!0),n.getNewsLetterCategoriesFromDeviceDB(!1).then(function(e){null==e||angular.isUndefined(e.categories)?console.log("No data is available"):d.category=e.categories})}function c(){r(function(){d.showUndoInbox=!1,d.undoEmailIdInbox=0},3e3)}t.broadcastNetworkAvailability();var d=this;d.selectedCategory="",d.category=[],d.showSearchTextBox=!1,d.searchText,d.activeslide=1,d.inboxItems=[],d.swipedToSave=[],d.pageNumber=0,d.moreItemsAvailable=!1,d.showUndoInbox=!1,d.showUndoInbox=!1,d.undoEmail={},d.undoEmailIdInbox=0,d.undoMessageInbox="",d.showTutorialOverlay=!1,d.showloader=!0,d.showDefaultImage=!1,d.canrefresh=!0,d.viewMoreLoader=!1,d.UnreadCount=0,d.lastId=0,d.pullRefreshText=t.isNetworkAvailable()?"Pull to refresh...":"Network unavailable",d.canrefresh=!0,u(),d.populateNewsletters=function(){d.inboxItems.length<1&&(d.moreItemsAvailable=!0),d.pageNumber=d.pageNumber+1,d.moreItemsAvailable&&(d.pageNumber>1&&(d.viewMoreLoader=!0),n.getEmailsFromDeviceDB("Save",d.pageNumber,d.lastId).then(function(e){if(d.moreItemsAvailable=!1,!angular.isUndefined(e)&&null!=e&&e.length){d.showDefaultImage=!1;var t=1;angular.forEach(e,function(e){d.inboxItems.push(e),1==d.inboxItems.length&&(d.lastId=e.emailid),t==d.inboxItems.length&&(d.viewMoreLoader=!1,d.showloader=!1,d.showDefaultImage=!1),t++}),d.moreItemsAvailable=!0}else d.moreItemsAvailable=!1,d.viewMoreLoader=!1,d.showloader=!1,d.inboxItems.length<1&&(d.showDefaultImage=!0);a.$broadcast("scroll.infiniteScrollComplete")},function(e){a.$broadcast("scroll.infiniteScrollComplete"),d.showloader=!1,d.viewMoreLoader=!1,d.showloader=!1}))},a.$on("$ionicView.enter",function(){d.lastId=0,d.moreItemsAvailable=!0,d.pageNumber=0,d.inboxItems=[],d.selectedCategory="",d.populateNewsletters()}),d.onSlide=function(t,o){d.undoEmailIdInbox=t;var a=0;0===o?(a=1,d.undoMessageInbox="1 item moved to inbox."):(a=3,d.undoMessageInbox="1 item deleted."),i.canDragContent(!1),n.updateEmailToDeviceDB(t,a).then(function(o){o&&(e.updateEmail(t,a).then(function(e){if(!e.isSuccessful&&e.saveToApiLog){var o={Emailid:t,StatusId:a},i={apiCallType:"emailStatusChange",dataObject:JSON.stringify(o)};n.InsertIntoApiFailedLog(i)}}),d.removeEmail(t))}),d.showUndoInbox=!0,c()},d.removeEmail=function(e){var t=o("filter")(d.inboxItems,{emailid:e},!0);if(t.length){var n=d.inboxItems.indexOf(t[0]);d.inboxItems.splice(n,1),d.undoEmail=t[0]}d.inboxItems.length<10&&d.populateNewsletters(),d.inboxItems.length<1&&(d.showDefaultImage=!0)},d.doRefresh=function(){d.canrefresh&&(d.canrefresh=!1,d.lastId>0?n.getNewEmailsFromDeviceDB("Save",d.lastId).then(function(e){!angular.isUndefined(e)&&null!=e&&e.length?(angular.forEach(e,function(e){d.inboxItems.unshift(e)}),d.showDefaultImage=!1,d.canrefresh=!0,a.$broadcast("scroll.refreshComplete")):(d.canrefresh=!0,a.$broadcast("scroll.refreshComplete"))},function(e){d.canrefresh=!0,a.$broadcast("scroll.refreshComplete")}):(d.pageNumber=0,d.populateNewsletters(),d.canrefresh=!0,a.$broadcast("scroll.refreshComplete")))},d.categoryChanged=function(){d.showDefaultImage=!1;var e=d.selectedCategory;e.length>0?(d.pageNumber=0,d.inboxItems=[],d.moreItemsAvailable=!1,d.lastId=0,n.getEmailsByCategory("Save",e).then(function(e){!angular.isUndefined(e)&&null!=e&&e.length?angular.forEach(e,function(e){d.inboxItems.push(e)}):d.showDefaultImage=!0})):(d.lastId=0,d.moreItemsAvailable=!0,d.pageNumber=0,d.inboxItems=[],d.populateNewsletters())},d.undoPreviousActionInbox=function(){d.showUndoInbox=!1,d.undoEmailIdInbox>0&&n.updateEmailToDeviceDB(d.undoEmailIdInbox,2).then(function(t){e.updateEmail(d.undoEmailIdInbox,2).then(function(e){d.inboxItems.push(d.undoEmail),d.showUndoInbox=!1,d.undoEmailIdInbox=0,d.showDefaultImage=!1})})},d.gotosearch=function(){s.nextViewOptions({historyRoot:!0}),l.transitionTo("app.search",{status:"Save"})},a.$on("UnreadCountSaved",function(e,t){d.UnreadCount=t}),d.updateEmailFromModal=function(e){angular.forEach(e,function(e){d.removeEmail(e)})},d.updateCssFromModal=function(e){angular.forEach(e,function(e){var t="email"+e,n=document.getElementById(t);null!=n&&(n.style.backgroundColor="#eee")})}}angular.module("newsletterApp").controller("savedController",e),e.$inject=["dataService","authService","sqlLiteService","$filter","$ionicSideMenuDelegate","$scope","$timeout","$ionicHistory","$state"]}(),angular.module("newsletterApp").directive("ionSearch",["$timeout",function(e){return{restrict:"E",replace:!0,scope:{getData:"&source",model:"=?",search:"=?filter"},link:function(t,n,o){o.minLength=o.minLength||0,t.placeholder=o.placeholder||"",t.search={value:""};var i;e(function(){var e=document.getElementById("search");null!=e&&e.focus(),ionic.Platform.isAndroid()&&cordova.plugins.Keyboard.show()},150),o["class"]&&n.addClass(o["class"]),o.source&&t.$watch("search.value",function(n,a){n.length>o.minLength?(i=n,e(function(){i==n&&t.getData({str:n})},1e3)):t.model=[]}),t.clearSearch=function(){t.search.value=""}},template:'<div class="item-input-wrapper"><i class="icon ion-android-search"></i><input type="search" id="search" placeholder="{{placeholder}}" ng-model="search.value" autofocus><i ng-if="search.value.length > 0" ng-click="clearSearch()" class="icon ion-close" ></i></div>'}}]),function(){"use strict";function e(e,t,n,o,i,a,r,s,l){function u(){i(function(){c.showUndoInbox=!1,c.undoEmailIdInbox=0},3e3)}var c=this;c.selectedCategory=angular.isUndefined(a.category)?"":a.category,c.category=[],c.activeslide=1,c.inboxItems=[],c.searchItems=[],c.swipedToSave=[],c.pageNumber=0,c.moreItemsAvailable=!0,c.showUndoInbox=!1,c.showUndoInbox=!1,c.undoEmail={},c.undoEmailIdInbox=0,c.undoMessageInbox="",c.showTutorialOverlay=!1,c.showloader=!0,c.defaultImg="img/newsletter/default_inbox.png",c.showDefaultImage=!1,c.canrefresh=!0,c.emailStatus=a.status,c.searchPhase,c.onSlide=function(n,o){c.undoEmailIdInbox=n;var i=0;0===o?(i="Inbox"===c.emailStatus?2:1,c.undoMessageInbox="1 item moved to"+c.emailStatus=="Inbox"?" saved.":"inbox"):(i=3,c.undoMessageInbox="1 item deleted."),l.canDragContent(!1),t.updateEmailToDeviceDB(n,i).then(function(o){o&&(e.updateEmail(n,i).then(function(e){if(!e.isSuccessful&&e.saveToApiLog){var o={Emailid:n,StatusId:i},a={apiCallType:"emailStatusChange",dataObject:JSON.stringify(o)};t.InsertIntoApiFailedLog(a)}}),c.removeEmail(n))}),c.showUndoInbox=!0,u()},c.removeEmail=function(e){var t=n("filter")(c.inboxItems,{emailid:e},!0);if(t.length){var o=c.inboxItems.indexOf(t[0]);c.inboxItems.splice(o,1),c.undoEmail=t[0]}},c.undoPreviousActionInbox=function(){if(c.showUndoInbox=!1,c.undoEmailIdInbox>0){var n="Inbox"===c.emailStatus?1:2;t.updateEmailToDeviceDB(c.undoEmailIdInbox,n).then(function(t){c.inboxItems.push(c.undoEmail),c.showUndoInbox=!1,c.undoEmailIdInbox=0,e.updateEmail(c.undoEmailIdInbox,n).then(function(e){})})}},c.goback=function(){r.nextViewOptions({historyRoot:!0}),"Inbox"===c.emailStatus?s.go("app.inbox"):s.go("app.saved")},o.getEmails=function(e){c.searchPhase=e,t.search(e,c.emailStatus).then(function(e){return c.inboxItems=[],c.inboxItems=e,e},function(e){return console.log(e),null})},c.updateCssFromModal=function(e){var t="email"+e,n=document.getElementById(t);null!=n&&(n.style.backgroundColor="#eee")}}angular.module("newsletterApp").controller("searchController",e),e.$inject=["dataService","sqlLiteService","$filter","$scope","$timeout","$stateParams","$ionicHistory","$state","$ionicSideMenuDelegate"]}(),function(){"use strict";function e(e,t,n,o,i,a,r,s,l,u,c,d,m,g){function p(){s(function(){e.showUndo=!1,e.undoStatus=0,e.undoEmailId=0},3e3)}e.emailSlide=[],e.email,e.prevEmail,e.openFeedback=!1,e.share=!1,e.emailStatus=!1,e.slideMessage=!1,e.slideMessageShown=!1,e.showUndo=!1,e.undoStatus=0,e.undoEmailId=0,e.undoMessage="",e.showNotInterestedMessage=!1,e.showloader_det=!0,e.searchPhase,e.subscribed=!0,e.feedback={},e.feedbackError=!1,e.showEmailDSMAction=!0,e.openPopover=function(t){e.popover.show(t)},e.closePopover=function(){e.popover.hide()},i.fromTemplateUrl("app/search/searchDetail.html",{scope:e,animation:"fade-in"}).then(function(t){e.modal=t}),e.openModal=function(t,n,i){e.searchPhase=i,e.emailStatus=n,o.getEmailDetailfromDeviceDB(t,n).then(function(t){e.emailSlide=[],e.emailSlide.push({email:e.email,prevEmail:e.prevEmail}),e.email=t.email,o.markAsRead(e.email.emailid,n),e.PopulatePopOverTemplate(),e.showloader_det=!1}),e.modal.show()},e.closeModal=function(){e.$parent.vm.updateCssFromModal(e.email.emailid),e.emailSlide=[],e.email="",e.prevEmail="",e.modal.hide()},e.$on("$destroy",function(){e.modal.remove()}),e.emailDSMAction=function(n,i,a){o.updateEmailToDeviceDB(n,i).then(function(a){a&&(t.updateEmail(n,i).then(function(t){if(!t.isSuccessful&&t.saveToApiLog){var a={Emailid:n,StatusId:i},r={apiCallType:"emailStatusChange",dataObject:JSON.stringify(a)};o.InsertIntoApiFailedLog(r)}e.openFeedback=!1,e.share=!1}),e.showUndo=!0),e.$parent.vm.removeEmail(n),e.$parent.vm.updateCssFromModal(e.email.emailid),e.emailSlide=[],e.email="",e.prevEmail="",e.modal.hide()})},e.notInterested=function(n){e.openFeedback=!1,e.share=!1,o.saveNewsletterAsUnsubFromDeviceDb(n).then(function(){t.saveNewsletterAsUnsub(n).then(function(e){if(!e.isSuccessful){var t=({Emailid:n,StatusId:status},{apiCallType:"notInterested",dataObject:n.toString()});o.InsertIntoApiFailedLog(t)}}),e.closePopover(),e.showNotInterestedMessage=!0,s(function(){e.showNotInterestedMessage=!1},5e3)})},e.sendFeedback=function(){e.closePopover();var n=new Date,o=e.email.newsletterSignupId+"#[email] has send feedback for [brand]  "+e.email.subject+".  Feedback send on "+n.toLocaleDateString(),i=' <label class="item item-input item-stacked-label"><div class="input-label"> Description</div><textarea rows="3" name="description" placeholder="Please enter your feedback or comment."  id="description"  ng-model="feedback.Description" ></textarea></label><div class="form-error" ng-if="feedbackError">Please enter the description.</div>';c.confirm({template:i,title:"Feedback",scope:e,buttons:[{text:"Cancel"},{text:"<b>Submit</b>",type:"button-positive",onTap:function(n){if(e.feedback.Description){e.feedbackError=!1;var i={Type:"Feedback for particular email",Description:e.feedback.Description,Subject:o};t.sendFeedback(i).then(function(e){e.isSuccessful})}else e.feedbackError=!0,n.preventDefault()}}]}).then(function(e){})},e.getNextEmail=function(t){var n=null!=e.prevEmail?e.prevEmail.emailid:0;n>0?(e.openFeedback=!1,e.share=!1,o.getEmailDetailfromDeviceDB(n,e.emailStatus).then(function(t){e.prevEmail=t.prevEmail,e.email=t.email,e.emailSlide=[],e.emailSlide.push({email:e.email,prevEmail:e.prevEmail}),e.PopulatePopOverTemplate(),"Trending"!=e.emailStatus&&(e.showUndo=!0),p()})):(p(),s(function(){e.closeModal()},3e3))},e.undoPreviousAction=function(){e.$parent.vm.undoPreviousActionInbox(),e.showUndo=!1,e.undoEmailId>0&&e.undoStatus>0&&o.updateEmailToDeviceDB(e.undoEmailId,e.undoStatus).then(function(n){t.updateEmail(e.undoEmailId,e.undoStatus).then(function(t){e.undoStatus=0,o.getEmailDetailfromDeviceDB(e.undoEmailId,e.emailStatus).then(function(t){e.nextEmail=t.nextEmail,e.prevEmail=t.prevEmail,e.email=t.email,e.emailSlide=[],e.emailSlide.push({email:e.email,nextEmail:e.nextEmail,prevEmail:e.prevEmail})})})})},e.PopulatePopOverTemplate=function(){o.veirfySubscribed(e.email.newsletterSignupId,e.email.categoryId).then(function(t){e.subscribed=t.result;var n='<ion-popover-view class="fit"> <ion-content> <div class="list"><div ng-click="sendFeedback()" class="item item-icon-left"><i class="icon ion-reply-all"></i> Feedback</div>';"Trending"!=e.emailStatus&&(n=n+' <div ng-click="notInterested('+e.email.newsletterSignupId+')" class="item item-icon-left"> <i class="icon ion-thumbsdown"></i>Unsubscribe</div>'),"Save"===e.emailStatus&&(n=n+'<div  ng - click = "emailDSMAction('+e.email.emailid,'1)" class="item item-icon-left"><i class = "icon ion-email" > < / i >Move to Inbox'),n+="</div> </ion-content></ion-popover-view>",e.popover=l.fromTemplate(n,{scope:e}),e.closePopover=function(){e.popover.hide()},e.$on("$destroy",function(){e.popover.remove()})})},e.showEmailDSMActionFn=function(){e.showEmailDSMAction=!0}}angular.module("newsletterApp").controller("searchDetailController",e),e.$inject=["$scope","dataService","authService","sqlLiteService","$ionicModal","$sce","$window","$timeout","$ionicPopover","$ionicPlatform","$ionicPopup","$rootScope","$ionicHistory","$state"]}(),angular.module("newsletterApp").factory("authService",authService),authService.$inject=["$http","$q","$rootScope","envVariables","$cordovaNetwork"],angular.module("newsletterApp").factory("dataService",dataService),dataService.$inject=["$http","$q","$filter","CacheFactory","authService"],angular.module("newsletterApp").factory("$exceptionHandler",function(){return function(e,t){console.log(e,t)}}),angular.module("newsletterApp").factory("sqlLiteService",sqlLiteService),sqlLiteService.$inject=["$q","$rootScope","envVariables","$cordovaSQLite","authService","dataService","$cordovaNetwork","$filter","CacheFactory"],function(){"use strict";function e(e,t,n,o,i,a,r){function s(){t.getMemberFromDeviceDB().then(function(e){l.signupData=e})}e.broadcastNetworkAvailability();var l=this;l.showloading=!1,l.submitted=!1,l.signupData,l.doLogout=function(){a.confirm({title:"Logout",content:"Are you sure you want to log out?",buttons:[{text:"Cancel",type:"button-positive"},{text:"Ok",type:"button-positive",onTap:function(t){r.clearCache(),r.clearHistory(),e.logout()}}]}).then(function(e){console.log(e)})},s(),l.clearPasswordError=function(){l.signupForm.password.$setValidity("pattern",!0),l.signupForm.password.$setValidity("minlength",!0),l.signupForm.password.$setValidity("maxlength",!0),l.signupForm.password.$setPristine()},l.signupFormSubmit=function(n){return l.submitted=!1,/^[a-zA-Z0-9 ]*$/.test(l.signupData.password.trim())?l.signupData.password.trim().length<6?(l.signupForm.password.$setValidity("minlength",!1),void l.signupForm.password.$setDirty()):l.signupData.password.trim().length>20?(l.signupForm.password.$setValidity("maxlength",!1),void l.signupForm.password.$setDirty()):void(n||(l.showloading=!0,l.signupData.birthday=l.signupData.birthyear+"-"+l.signupData.birthmonth+"-"+l.signupData.birthdate,t.updateMemberToDeviceDB(l.signupData).then(function(t){t&&e.SaveMember(l.signupData).then(function(e){if(console.log(e),e.isSuccessful)l.showloading=!1,a.confirm({title:"Success",content:"Password has been updated.",buttons:[{text:"Close",type:"button-positive"}]}).then(function(e){});else{return l.showloading=!1,l.signupForm.password.$setValidity("pattern",!1),void l.signupForm.password.$setDirty()}})}))):(l.signupForm.password.$setValidity("pattern",!1),void l.signupForm.password.$setDirty())}}angular.module("newsletterApp").controller("settingsController",e),e.$inject=["authService","sqlLiteService","$state","$window","$scope","$ionicPopup","$ionicHistory"]}(),angular.module("newsletterApp").directive("passwordMatch",passwordMatch),function(){"use strict";function e(e,t,n,o,i,a,r,s,l,u){function c(){ionic.Platform.ready(function(){n.initNewsletterCategory()}),angular.isDefined(d)&&d.length&&(m.signupData.email=d),e.isAuthenticated()&&(i.nextViewOptions({historyRoot:!0}),o.transitionTo("app.subscription"))}var d=l.email,m=this;m.signUpDetailForm=!1,m.showPassword=!1,m.submitted=!1,m.signupData=[],m.submittedEmail,m.showloading=!1,m.year=(new Date).getFullYear(),m.maxyear=m.year-13,m.minyear=m.year-150,m.gobackState="home",c(),m.signUpFormNextClick=function(e,t){m.submittedEmail=!0,e&&t?/^[a-zA-Z0-9 ]*$/.test(m.signupData.password)&&m.signupData.password.length>5&&m.signupData.password.length<21?m.signUpDetailForm=!0:(/^[a-zA-Z0-9 ]*$/.test(m.signupData.password)?m.signupData.password.trim().length<6?(m.signupForm.password.$setValidity("minlength",!1),m.signupForm.password.$setDirty()):m.signupData.password.trim().length>20&&(m.signupForm.password.$setValidity("maxlength",!1),m.signupForm.password.$setDirty()):(m.signupForm.password.$setValidity("pattern",!1),m.signupForm.password.$setDirty()),m.signUpDetailForm=!1):m.signUpDetailForm=!1},m.signFormsubmit=function(t){if(m.validateDate(),m.submitted=!0,!(t||m.errorMessage.length>0)){m.showloading=!0;var a={email:m.signupData.email,firstName:m.signupData.firstName,lastName:m.signupData.lastName,postalCode:m.signupData.postalCode,password:m.signupData.password,phone:"",province:"",city:"",mobileNo:"",gender:m.signupData.gender,language:"",birthday:m.signupData.birthyear+"-"+m.signupData.birthmonth+"-"+m.signupData.birthdate,signupIds:[],id:0};e.SaveMember(a).then(function(e){return e.isSuccessful?(localStorage.FirstTimeUser=!0,void n.login(m.signupData.email,m.signupData.password).then(function(e){return null!=e&&angular.isUndefined(e.error)&&e.access_token.length>0?(a.id=e.member_id,void n.setMemberTODeviceDB(a).then(function(){m.showloading=!1,i.nextViewOptions({historyRoot:!0}),o.go("app.subscription",{},{reload:!0})})):(m.showloading=!1,void(null==e.message||angular.isUndefined(e.message)?m.errorMessage="An error has occured in api":m.errorMessage=e.message))})):(m.showloading=!1,void(null==e.message||angular.isUndefined(e.message)?m.errorMessage="An error has occured":m.errorMessage=e.message))})}},m.goback=function(e){return console.log(m.gobackState),m.signupForm.$setUntouched(),m.submittedEmail=!1,i.nextViewOptions({historyRoot:!0}),1==e&&"home"===m.gobackState?void o.go("app.home"):void o.go("app.login")},m.signFormBackButtonClick=function(){m.signUpDetailForm=!1,r.scrollTop()},m.scrolltop=function(){r.scrollBy(0,80,!0)},m.clearPasswordError=function(){r.scrollBy(0,40,!0),m.signupForm.password.$setValidity("pattern",!0),m.signupForm.password.$setValidity("minlength",!0),m.signupForm.password.$setValidity("maxlength",!0),m.signupForm.password.$setPristine()},m.validateDate=function(){return(4==m.signupData.birthmonth||6==m.signupData.birthmonth||9==m.signupData.birthmonth||11==m.signupData.birthmonth)&&m.signupData.birthdate>=31?void(m.errorMessage="Please enter a valid date."):(m.errorMessage="",void(m.signupData.birthmonth>0&&m.signupData.birthdate>0&&(2==m.signupData.birthmonth&&m.signupData.birthdate>29?m.errorMessage="Please enter a valid date.":m.errorMessage="")))},u.$on("$stateChangeSuccess",function(e,t,n,o,i){"app.signup"!=o.name&&("app.home"===o.name&&(m.gobackState="home"),"app.login"===o.name&&(angular.isUndefined(localStorage.FirstTimeUser)&&null==localStorage.FirstTimeUser?m.gobackState="home":m.gobackState="",console.log(m.gobackState)))})}angular.module("newsletterApp").controller("signupController",e),e.$inject=["authService","dataService","sqlLiteService","$state","$ionicHistory","$window","$ionicScrollDelegate","$cordovaSQLite","$stateParams","$scope"]}(),checkEmail.$inject=["authService"],angular.module("newsletterApp").directive("checkEmail",checkEmail),function(){"use strict";function e(e,t,n){ionic.Platform.ready(function(){n.nextViewOptions({historyRoot:!0}),e.go("app.inbox")})}angular.module("newsletterApp").controller("splashController",e),e.$inject=["$state","$scope","$ionicHistory"]}(),function(){"use strict";function e(e,t,n,o,i,a,r,s,l,u,c){function d(e){n.getCategoryFromDeviceDB(g.id).then(function(e){g.category=e}),n.getNewslettersFromDeviceDB(g.id,0,null).then(function(e){if(!angular.isUndefined(e.newsletterSignup)&&e.newsletterSignup.length>0){var t=[],n=0;angular.forEach(e.newsletterSignup,function(e){!angular.isUndefined(g.signupIds)&&g.signupIds.length&&g.signupIds.indexOf(e.id)>-1&&(n+=1,t.push({nl:e,nlOrder:n}))}),angular.forEach(e.newsletterSignup,function(e){(angular.isUndefined(g.signupIds)||0===g.signupIds.length||g.signupIds.length&&-1===g.signupIds.indexOf(e.id))&&(n+=1,t.push({nl:e,nlOrder:n}))}),g.newsletters=t,g.showloading=!1,t.length==g.signupIds.length?g.selectAll=!1:g.selectAll=!0}})}function m(){var e=a.defer();g.signupIds=[];var t=!1;return 0==g.id?n.getMemberNewsletterCategoryIdsFromDeviceDB().then(function(n){!angular.isUndefined(n)&&n.length?(g.signupIds=[],angular.forEach(n,function(e){g.signupIdsCategory.push(e),angular.forEach(e.nlIds,function(e){g.signupIds.push(e)})}),t=!0,e.resolve(t)):e.resolve(t)}):n.getMemberNewslettersFromDeviceDB(g.id).then(function(n){!angular.isUndefined(n)&&n.length?(g.signupIds=n,t=!0,e.resolve(t)):(console.log("no data"),e.resolve(t))}),e.promise}var g=this;g.category={},g.signupIds=[],g.signupIdsCategory=[],g.newsletters=[],g.id=i.id,g.memberSignUpIds=[],g.showloading=!0,g.selectAll=!1,l.$on("$ionicView.beforeEnter",function(e,t){m().then(function(e){d(1)})}),g.setSelectedList=function(e,t){var n=g.signupIds.indexOf(e);if(n>-1?g.signupIds.splice(n,1):g.signupIds.push(e),0==g.id){var o=r("filter")(g.signupIdsCategory,{cId:t},!0);if(!angular.isUndefined(o)&&o.length){var i=g.signupIdsCategory.indexOf(o[0]),a=o[0].nlIds,s=a.indexOf(e);s>-1?a.splice(s,1):a.push(e),o[0].nlIds=a,o[0].nlIds.length<1?g.signupIdsCategory.splice(i,1):g.signupIdsCategory[i]=angular.copy(o[0])}else{var a=[];a.push(e),g.signupIdsCategory.push({cId:t,nlIds:a})}}},g.subscriptionFormsubmit=function(){g.showloading||(0==g.id?n.insertMemberNewsletterToDeviceDB(g.signupIdsCategory,!0).then(function(e){t.saveMemberSignupList(g.signupIds).then(function(e){if(!angular.isUndefined(e.isSuccessful)&&!e.isSuccessful&&e.saveToApiLog){var t={signupIds:g.signupIds,cId:0},i={memberId:0,apiCallType:"sub",dataObject:JSON.stringify(t)};n.InsertIntoApiFailedLog(i)}s.nextViewOptions({historyRoot:!0}),o.go("app.subscription",{reload:!0})})}):n.updateMemberNewsletterToDeviceDB(g.signupIds,g.id).then(function(e){t.saveMemberSignupList(g.signupIds,g.id).then(function(e){if(!angular.isUndefined(e.isSuccessful)&&!e.isSuccessful&&e.saveToApiLog){var t={signupIds:g.signupIds,cId:g.id},i={memberId:0,apiCallType:"sub",dataObject:JSON.stringify(t)};n.InsertIntoApiFailedLog(i),s.nextViewOptions({historyRoot:!0}),o.go("app.subscription",{reload:!0})}e.isSuccessful&&(s.nextViewOptions({historyRoot:!0}),o.go("app.subscription",{reload:!0}))})}))},u.registerBackButtonAction(function(){"app.subscription-category"==o.current.name?(g.showloading||(0==g.id?n.insertMemberNewsletterToDeviceDB(g.signupIdsCategory,!0).then(function(e){t.saveMemberSignupList(g.signupIds).then(function(e){if(!angular.isUndefined(e.isSuccessful)&&!e.isSuccessful&&e.saveToApiLog){var t={signupIds:g.signupIds,cId:0},o={memberId:0,apiCallType:"sub",dataObject:JSON.stringify(t)};n.InsertIntoApiFailedLog(o)}})}):n.updateMemberNewsletterToDeviceDB(g.signupIds,g.id).then(function(e){t.saveMemberSignupList(g.signupIds,g.id).then(function(e){if(!angular.isUndefined(e.isSuccessful)&&!e.isSuccessful&&e.saveToApiLog){var t={signupIds:g.signupIds,cId:g.id},o={memberId:0,apiCallType:"sub",dataObject:JSON.stringify(t)};n.InsertIntoApiFailedLog(o)}})})),s.nextViewOptions({historyRoot:!0}),navigator.app.backHistory()):"app.inbox"==o.current.name?navigator.app.exitApp():(s.nextViewOptions({historyRoot:!0}),navigator.app.backHistory())},200),g.SelectAllButton=function(){g.signupIds=[],g.signupIdsCategory=[],angular.forEach(g.newsletters,function(e){g.signupIds.push(e.nl.id)}),0==g.id&&angular.forEach(g.newsletters,function(e){var t=e.nl.id,n=e.nl.categoryId,o=r("filter")(g.signupIdsCategory,{cId:n},!0);if(!angular.isUndefined(o)&&o.length){var i=g.signupIdsCategory.indexOf(o[0]),a=o[0].nlIds,s=a.indexOf(t);0>s&&a.push(t),o[0].nlIds=a,o[0].nlIds.length<1?g.signupIdsCategory.splice(i,1):g.signupIdsCategory[i]=angular.copy(o[0])}else{var a=[];a.push(t),g.signupIdsCategory.push({cId:n,nlIds:a})}}),c(function(){g.selectAll=!1},500)},g.UnSelectAllButton=function(){g.signupIds=[],g.signupIdsCategory=[],c(function(){g.selectAll=!0},500)}}angular.module("newsletterApp").controller("subscriptioncategoryController",e),e.$inject=["authService","dataService","sqlLiteService","$state","$stateParams","$q","$filter","$ionicHistory","$scope","$ionicPlatform","$timeout"]}(),function(){"use strict";function e(e,t,n,o,i,a,r,s,l,u,c,d){function m(){var e=l.defer();p.signupIds=[],p.signupIdsCategory=[];var t=!1;return s.getMemberNewsletterCategoryIdsFromDeviceDB().then(function(n){!angular.isUndefined(n)&&n.length?(p.signupIds=[],angular.forEach(n,function(e){p.signupIdsCategory.push(e),angular.forEach(e.nlIds,function(e){p.signupIds.push(e)})}),t=!0,e.resolve(t)):e.resolve(t)}),e.promise}function g(e){p.newsletters=[],p.category=[],p.categoryData=[],s.getNewsLetterCategoriesFromDeviceDB(!1).then(function(e){if(null==e||angular.isUndefined(e.categories)||null==e.categories)p.showloading=!1,console.log("No data is available");else{p.categoryData=e;var t=[{id:0,name:"All",orderNumber:1,iconName:"ion-ios-world"}];p.category.push(t),angular.forEach(e.categories,function(e){p.category[0].push(e)}),angular.forEach(p.category[0],function(e,t){var n=r("filter")(p.signupIdsCategory,{cId:e.id},!0),o=[];0==e.id&&(o=p.signupIds.slice(0,10)),!angular.isUndefined(n)&&n.length&&(o=[],o=n[0].nlIds),s.getNewslettersFromDeviceDB(e.id,10,o).then(function(t){var n=0,o=[];if(null!=t&&!angular.isUndefined(t.newsletterSignup)&&null!=t.newsletterSignup&&t.newsletterSignup.length>0){angular.forEach(t.newsletterSignup,function(e){!angular.isUndefined(p.signupIds)&&p.signupIds.length&&p.signupIds.indexOf(e.id)>-1&&(n+=1,o.push({nl:e,nlOrder:n}))}),angular.forEach(t.newsletterSignup,function(e){(angular.isUndefined(p.signupIds)||0===p.signupIds.length||p.signupIds.length&&-1===p.signupIds.indexOf(e.id))&&(n+=1,o.push({nl:e,nlOrder:n}))});var i={category:e,newsletters:o,order:e.orderNumber};p.newsletters.push(i),p.showloading=!1}})})}})}e.broadcastNetworkAvailability();var p=this;p.signupIds=[],p.signupIdsCategory=[],p.newsletters=[],p.category=[],p.categoryData=[],p.active=-1,p.checkboxRequired=!1,p.showloading=!0,u.$on("$ionicView.beforeEnter",function(e,t){s.initNewsletterCategory().then(function(e){m().then(function(e){g(1),angular.isDefined(localStorage.cId)&&null!=localStorage.cId&&localStorage.cId.length&&(p.active=parseInt(localStorage.cId),console.log(p.active))})})}),p.setSelectedList=function(e,t){var n=p.signupIds.indexOf(e);n>-1?p.signupIds.splice(n,1):p.signupIds.push(e);var o=r("filter")(p.signupIdsCategory,{cId:t},!0);if(console.log(t),!angular.isUndefined(o)&&o.length){var i=p.signupIdsCategory.indexOf(o[0]),a=o[0].nlIds,s=a.indexOf(e);s>-1?a.splice(s,1):a.push(e),o[0].nlIds=a,o[0].nlIds.length<1?p.signupIdsCategory.splice(i,1):p.signupIdsCategory[i]=angular.copy(o[0])}else{var a=[];a.push(e),p.signupIdsCategory.push({cId:t,nlIds:a})}},p.activateCategory=function(e){if(e===p.active)p.active=-1,a.scrollTop();else{p.active=e;var t=r("filter")(p.category[0],{id:e},!0);null!=t&&p.category[0].indexOf(t[0])==p.category[0].length-1?d(function(){a.scrollBottom(!0)},200):a.scrollBy(0,80,!0)}},p.moreCategory=function(e){localStorage.cId=e,s.insertMemberNewsletterToDeviceDB(p.signupIdsCategory,!0).then(function(i){t.saveMemberSignupList(p.signupIds).then(function(t){if(!angular.isUndefined(t.isSuccessful)&&!t.isSuccessful&&t.saveToApiLog){var i={signupIds:p.signupIds,cId:0},a={memberId:0,apiCallType:"sub",dataObject:JSON.stringify(i)};s.InsertIntoApiFailedLog(a)}o.nextViewOptions({historyRoot:!0}),n.transitionTo("app.subscription-category",{id:e})})})},p.gotoInbox=function(){o.nextViewOptions({historyRoot:!0}),n.go("app.inbox")},u.$on("$locationChangeStart",function(e,n,o){o.indexOf("subscription")>-1&&-1===o.indexOf("subscription-category")&&-1===n.indexOf("subscription-category")&&(s.insertMemberNewsletterToDeviceDB(p.signupIdsCategory,!0).then(function(e){t.saveMemberSignupList(p.signupIds).then(function(e){if(!angular.isUndefined(e.isSuccessful)&&!e.isSuccessful&&e.saveToApiLog){var t={signupIds:p.signupIds,cId:0},n={memberId:0,apiCallType:"sub",dataObject:JSON.stringify(t)};s.InsertIntoApiFailedLog(n)}})}),localStorage.cId="")})}angular.module("newsletterApp").controller("subscriptionController",e),e.$inject=["authService","dataService","$state","$ionicHistory","$window","$ionicScrollDelegate","$filter","sqlLiteService","$q","$scope","$rootScope","$timeout"]}(),function(){"use strict";function e(e,t,n){n.broadcastNetworkAvailability();var o=this;o.trendingItems=[],o.showSearchTextBox=!1,o.searchText,o.moreDataCanBeLoaded=!1,o.showDefaultImage=!1,o.showloader=!0,o.populateNewsletters=function(){e.getTrendingEmailFromDeviceDB(!0).then(function(e){console.log(e),o.trendingItems=e,null!==e&&e.length||(o.showDefaultImage=!0),o.showloader=!1},function(e){o.showloader=!1})},o.populateNewsletters()}angular.module("newsletterApp").controller("trendingController",e),e.$inject=["sqlLiteService","$scope","authService"]}();
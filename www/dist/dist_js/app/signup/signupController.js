!function(){"use strict";function a(a,e,t,s,i,n,o,r,g,l){function p(){ionic.Platform.ready(function(){t.initNewsletterCategory()}),angular.isDefined(u)&&u.length&&(d.signupData.email=u),a.isAuthenticated()&&(i.nextViewOptions({historyRoot:!0}),s.transitionTo("app.subscription"))}var u=g.email,d=this;d.signUpDetailForm=!1,d.showPassword=!1,d.submitted=!1,d.signupData=[],d.submittedEmail,d.showloading=!1,d.year=(new Date).getFullYear(),d.maxyear=d.year-13,d.minyear=d.year-150,d.gobackState="home",p(),d.signUpFormNextClick=function(a,e){d.submittedEmail=!0,a&&e?/^[a-zA-Z0-9 ]*$/.test(d.signupData.password)&&d.signupData.password.length>5&&d.signupData.password.length<21?d.signUpDetailForm=!0:(/^[a-zA-Z0-9 ]*$/.test(d.signupData.password)?d.signupData.password.trim().length<6?(d.signupForm.password.$setValidity("minlength",!1),d.signupForm.password.$setDirty()):d.signupData.password.trim().length>20&&(d.signupForm.password.$setValidity("maxlength",!1),d.signupForm.password.$setDirty()):(d.signupForm.password.$setValidity("pattern",!1),d.signupForm.password.$setDirty()),d.signUpDetailForm=!1):d.signUpDetailForm=!1},d.signFormsubmit=function(e){if(d.validateDate(),d.submitted=!0,!(e||d.errorMessage.length>0)){d.showloading=!0;var n={email:d.signupData.email,firstName:d.signupData.firstName,lastName:d.signupData.lastName,postalCode:d.signupData.postalCode,password:d.signupData.password,phone:"",province:"",city:"",mobileNo:"",gender:d.signupData.gender,language:"",birthday:d.signupData.birthyear+"-"+d.signupData.birthmonth+"-"+d.signupData.birthdate,signupIds:[],id:0};a.SaveMember(n).then(function(a){return a.isSuccessful?(localStorage.FirstTimeUser=!0,void t.login(d.signupData.email,d.signupData.password).then(function(a){return null!=a&&angular.isUndefined(a.error)&&a.access_token.length>0?(n.id=a.member_id,void t.setMemberTODeviceDB(n).then(function(){d.showloading=!1,i.nextViewOptions({historyRoot:!0}),s.go("app.subscription",{},{reload:!0})})):(d.showloading=!1,void(null==a.message||angular.isUndefined(a.message)?d.errorMessage="An error has occured in api":d.errorMessage=a.message))})):(d.showloading=!1,void(null==a.message||angular.isUndefined(a.message)?d.errorMessage="An error has occured":d.errorMessage=a.message))})}},d.goback=function(a){return console.log(d.gobackState),d.signupForm.$setUntouched(),d.submittedEmail=!1,i.nextViewOptions({historyRoot:!0}),1==a&&"home"===d.gobackState?void s.go("app.home"):void s.go("app.login")},d.signFormBackButtonClick=function(){d.signUpDetailForm=!1,o.scrollTop()},d.scrolltop=function(){o.scrollBy(0,80,!0)},d.clearPasswordError=function(){o.scrollBy(0,40,!0),d.signupForm.password.$setValidity("pattern",!0),d.signupForm.password.$setValidity("minlength",!0),d.signupForm.password.$setValidity("maxlength",!0),d.signupForm.password.$setPristine()},d.validateDate=function(){return(4==d.signupData.birthmonth||6==d.signupData.birthmonth||9==d.signupData.birthmonth||11==d.signupData.birthmonth)&&d.signupData.birthdate>=31?void(d.errorMessage="Please enter a valid date."):(d.errorMessage="",void(d.signupData.birthmonth>0&&d.signupData.birthdate>0&&(2==d.signupData.birthmonth&&d.signupData.birthdate>29?d.errorMessage="Please enter a valid date.":d.errorMessage="")))},l.$on("$stateChangeSuccess",function(a,e,t,s,i){"app.signup"!=s.name&&("app.home"===s.name&&(d.gobackState="home"),"app.login"===s.name&&(angular.isUndefined(localStorage.FirstTimeUser)&&null==localStorage.FirstTimeUser?d.gobackState="home":d.gobackState="",console.log(d.gobackState)))})}angular.module("newsletterApp").controller("signupController",a),a.$inject=["authService","dataService","sqlLiteService","$state","$ionicHistory","$window","$ionicScrollDelegate","$cordovaSQLite","$stateParams","$scope"]}();
!function(){"use strict";function e(e,i,a,t,o,n,l,s,c,r,d,m,u,p){function v(){s(function(){e.showUndo=!1,e.undoStatus=0,e.undoEmailId=0},3e3)}e.emailSlide=[],e.email,e.prevEmail,e.openFeedback=!1,e.share=!1,e.emailStatus=!1,e.slideMessage=!1,e.slideMessageShown=!1,e.showUndo=!1,e.undoStatus=0,e.undoEmailId=0,e.undoMessage="",e.showNotInterestedMessage=!1,e.showloader_det=!0,e.searchPhase,e.subscribed=!0,e.feedback={},e.feedbackError=!1,e.showEmailDSMAction=!0,e.openPopover=function(i){e.popover.show(i)},e.closePopover=function(){e.popover.hide()},o.fromTemplateUrl("app/search/searchDetail.html",{scope:e,animation:"fade-in"}).then(function(i){e.modal=i}),e.openModal=function(i,a,o){e.searchPhase=o,e.emailStatus=a,t.getEmailDetailfromDeviceDB(i,a).then(function(i){e.emailSlide=[],e.emailSlide.push({email:e.email,prevEmail:e.prevEmail}),e.email=i.email,t.markAsRead(e.email.emailid,a),e.PopulatePopOverTemplate(),e.showloader_det=!1}),e.modal.show()},e.closeModal=function(){e.$parent.vm.updateCssFromModal(e.email.emailid),e.emailSlide=[],e.email="",e.prevEmail="",e.modal.hide()},e.$on("$destroy",function(){e.modal.remove()}),e.emailDSMAction=function(a,o,n){t.updateEmailToDeviceDB(a,o).then(function(n){n&&(i.updateEmail(a,o).then(function(i){if(!i.isSuccessful&&i.saveToApiLog){var n={Emailid:a,StatusId:o},l={apiCallType:"emailStatusChange",dataObject:JSON.stringify(n)};t.InsertIntoApiFailedLog(l)}e.openFeedback=!1,e.share=!1}),e.showUndo=!0),e.$parent.vm.removeEmail(a),e.$parent.vm.updateCssFromModal(e.email.emailid),e.emailSlide=[],e.email="",e.prevEmail="",e.modal.hide()})},e.notInterested=function(a){e.openFeedback=!1,e.share=!1,t.saveNewsletterAsUnsubFromDeviceDb(a).then(function(){i.saveNewsletterAsUnsub(a).then(function(e){if(!e.isSuccessful){var i=({Emailid:a,StatusId:status},{apiCallType:"notInterested",dataObject:a.toString()});t.InsertIntoApiFailedLog(i)}}),e.closePopover(),e.showNotInterestedMessage=!0,s(function(){e.showNotInterestedMessage=!1},5e3)})},e.sendFeedback=function(){e.closePopover();var a=new Date,t=e.email.newsletterSignupId+"#[email] has send feedback for [brand]  "+e.email.subject+".  Feedback send on "+a.toLocaleDateString(),o=' <label class="item item-input item-stacked-label"><div class="input-label"> Description</div><textarea rows="3" name="description" placeholder="Please enter your feedback or comment."  id="description"  ng-model="feedback.Description" ></textarea></label><div class="form-error" ng-if="feedbackError">Please enter the description.</div>';d.confirm({template:o,title:"Feedback",scope:e,buttons:[{text:"Cancel"},{text:"<b>Submit</b>",type:"button-positive",onTap:function(a){if(e.feedback.Description){e.feedbackError=!1;var o={Type:"Feedback for particular email",Description:e.feedback.Description,Subject:t};i.sendFeedback(o).then(function(e){e.isSuccessful})}else e.feedbackError=!0,a.preventDefault()}}]}).then(function(e){})},e.getNextEmail=function(i){var a=null!=e.prevEmail?e.prevEmail.emailid:0;a>0?(e.openFeedback=!1,e.share=!1,t.getEmailDetailfromDeviceDB(a,e.emailStatus).then(function(i){e.prevEmail=i.prevEmail,e.email=i.email,e.emailSlide=[],e.emailSlide.push({email:e.email,prevEmail:e.prevEmail}),e.PopulatePopOverTemplate(),"Trending"!=e.emailStatus&&(e.showUndo=!0),v()})):(v(),s(function(){e.closeModal()},3e3))},e.undoPreviousAction=function(){e.$parent.vm.undoPreviousActionInbox(),e.showUndo=!1,e.undoEmailId>0&&e.undoStatus>0&&t.updateEmailToDeviceDB(e.undoEmailId,e.undoStatus).then(function(a){i.updateEmail(e.undoEmailId,e.undoStatus).then(function(i){e.undoStatus=0,t.getEmailDetailfromDeviceDB(e.undoEmailId,e.emailStatus).then(function(i){e.nextEmail=i.nextEmail,e.prevEmail=i.prevEmail,e.email=i.email,e.emailSlide=[],e.emailSlide.push({email:e.email,nextEmail:e.nextEmail,prevEmail:e.prevEmail})})})})},e.PopulatePopOverTemplate=function(){t.veirfySubscribed(e.email.newsletterSignupId,e.email.categoryId).then(function(i){e.subscribed=i.result;var a='<ion-popover-view class="fit"> <ion-content> <div class="list"><div ng-click="sendFeedback()" class="item item-icon-left"><i class="icon ion-reply-all"></i> Feedback</div>';"Trending"!=e.emailStatus&&(a=a+' <div ng-click="notInterested('+e.email.newsletterSignupId+')" class="item item-icon-left"> <i class="icon ion-thumbsdown"></i>Unsubscribe</div>'),"Save"===e.emailStatus&&(a=a+'<div  ng - click = "emailDSMAction('+e.email.emailid,'1)" class="item item-icon-left"><i class = "icon ion-email" > < / i >Move to Inbox'),a+="</div> </ion-content></ion-popover-view>",e.popover=c.fromTemplate(a,{scope:e}),e.closePopover=function(){e.popover.hide()},e.$on("$destroy",function(){e.popover.remove()})})},e.showEmailDSMActionFn=function(){e.showEmailDSMAction=!0}}angular.module("newsletterApp").controller("searchDetailController",e),e.$inject=["$scope","dataService","authService","sqlLiteService","$ionicModal","$sce","$window","$timeout","$ionicPopover","$ionicPlatform","$ionicPopup","$rootScope","$ionicHistory","$state"]}();
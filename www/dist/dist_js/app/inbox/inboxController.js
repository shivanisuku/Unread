!function(){"use strict";function e(e,o,n,t,a,i,l,r,s,u,c,m){function d(){angular.isUndefined(localStorage.showTutorialOverlay)&&(I.showTutorialOverlay=!0),t.getNewsLetterCategoriesFromDeviceDB(!1).then(function(e){null===e||angular.isUndefined(e.categories)?console.log("No data is available"):I.category=e.categories})}function f(){I.moreItemsAvailable=!0,I.pageNumber=0,I.inboxItems=[],I.lastId=0,I.populateNewsletters().then(function(e){t.syncMemberEmailsToDeviceDB().then(function(e){e>0&&t.getNewEmailsFromDeviceDB("Inbox",e).then(function(e){!angular.isUndefined(e)&&null!=e&&e.length&&angular.forEach(e,function(e){I.inboxItems.unshift(e)})})})})}function h(){s(function(){I.showUndoInbox=!1,I.undoEmailIdInbox=0},3e3)}function g(){t.getEmailCount().then(function(e){I.defaultImg=e>0?"img/newsletter/default_not_first.png":"img/newsletter/default_inbox.png"})}n.broadcastNetworkAvailability();var I=this;I.selectedCategory="",I.category=[],I.showSearchTextBox=!1,I.searchText,I.activeslide=1,I.inboxItems=[],I.swipedToSave=[],I.pageNumber=0,I.moreItemsAvailable=!1,I.showUndoInbox=!1,I.showUndoInbox=!1,I.undoEmail={},I.undoEmailIdInbox=0,I.undoMessageInbox="",I.showTutorialOverlay=!1,I.showloader=!0,I.defaultImg="",I.showDefaultImage=!1,I.canrefresh=!0,I.viewMoreLoader=!1,I.pullRefreshText=n.isNetworkAvailable()?"Pull to refresh...":"Network unavailable",I.lastId=0,I.UnreadCount=0,d(),I.populateNewsletters=function(){var o=e.defer();return I.pageNumber=I.pageNumber+1,I.inboxItems.length<1&&(I.moreItemsAvailable=!0),I.moreItemsAvailable&&(I.moreItemsAvailable=!1,I.pageNumber>1&&(I.viewMoreLoader=!0),t.getEmailsFromDeviceDB("Inbox",I.pageNumber,I.lastId).then(function(e){if(!angular.isUndefined(e)&&null!=e&&e.length){I.showDefaultImage=!1;var n=1;angular.forEach(e,function(o){I.inboxItems.push(o),1==I.inboxItems.length&&(I.lastId=o.emailid),n==e.length&&(I.viewMoreLoader=!1,I.showloader=!1,I.showDefaultImage=!1,I.moreItemsAvailable=!0,r.$broadcast("scroll.infiniteScrollComplete")),n++}),g()}else I.moreItemsAvailable=!1,I.viewMoreLoader=!1,I.showloader=!1,r.$broadcast("scroll.infiniteScrollComplete");0==I.inboxItems.length&&(I.moreItemsAvailable=!1,I.showDefaultImage=!0,g()),o.resolve(!0)},function(e){r.$broadcast("scroll.infiniteScrollComplete"),I.viewMoreLoader=!1,I.showloader=!1,o.resolve(!1)})),o.promise},r.$on("$ionicView.enter",function(){I.selectedCategory="",f(),I.checkForNewEmails()}),I.onSlide=function(e,n){I.undoEmailIdInbox=e;var a=0;0===n?(a=2,I.undoMessageInbox="1 item moved to saved."):(a=3,I.undoMessageInbox="1 item deleted."),l.canDragContent(!1),t.updateEmailToDeviceDB(e,a).then(function(n){n&&(o.updateEmail(e,a).then(function(o){if(!o.isSuccessful&&o.saveToApiLog){var n={Emailid:e,StatusId:a},i={apiCallType:"emailStatusChange",dataObject:JSON.stringify(n)};t.InsertIntoApiFailedLog(i)}}),I.removeEmail(e))}),I.showUndoInbox=!0,h()},I.removeEmail=function(e){var o=i("filter")(I.inboxItems,{emailid:e},!0);if(o.length){var n=I.inboxItems.indexOf(o[0]);I.inboxItems.splice(n,1),I.undoEmail=o[0]}I.inboxItems.length<10&&I.populateNewsletters(),I.inboxItems.length<1&&(I.showDefaultImage=!0)},I.doRefresh=function(){I.canrefresh&&n.isAuthenticated()?(I.canrefresh=!1,t.syncMemberEmailsToDeviceDB().then(function(e){e>0?t.getNewEmailsFromDeviceDB("Inbox",e).then(function(e){!angular.isUndefined(e)&&null!=e&&e.length?(angular.forEach(e,function(e){I.selectedCategory>0&&e.categoryId==I.selectedCategory?I.inboxItems.unshift(e):(0===I.selectedCategory||""===I.selectedCategory)&&I.inboxItems.unshift(e)}),I.showDefaultImage=!1,I.canrefresh=!0,r.$broadcast("scroll.refreshComplete")):(I.canrefresh=!0,r.$broadcast("scroll.refreshComplete"))},function(e){I.canrefresh=!0,r.$broadcast("scroll.refreshComplete")}):(I.canrefresh=!0,r.$broadcast("scroll.refreshComplete"))})):r.$broadcast("scroll.refreshComplete")},I.categoryChanged=function(){var e=I.selectedCategory;e.length>0?(I.pageNumber=0,I.inboxItems=[],I.moreItemsAvailable=!1,I.lastId=0,t.getEmailsByCategory("Inbox",e).then(function(e){!angular.isUndefined(e)&&null!=e&&e.length?(angular.forEach(e,function(e){I.inboxItems.push(e)}),I.showDefaultImage=!1):I.showDefaultImage=!0})):f()},I.undoPreviousActionInbox=function(){I.showUndoInbox=!1,I.undoEmailIdInbox>0&&t.updateEmailToDeviceDB(I.undoEmailIdInbox,1).then(function(e){I.inboxItems.push(I.undoEmail),I.showUndoInbox=!1,I.undoEmailIdInbox=0,I.showDefaultImage=!1,o.updateEmail(I.undoEmailIdInbox,1).then(function(e){})})},I.closeTutorialOverlay=function(){I.showTutorialOverlay=!1,localStorage.showTutorialOverlay="false"},I.gotosearch=function(){u.nextViewOptions({historyRoot:!0}),c.transitionTo("app.search",{status:"Inbox"})},r.$on("UnreadCount",function(e,o){I.UnreadCount=o}),I.checkForNewEmails=function(){n.isAuthenticated()&&s(function(){I.doRefresh(),I.checkForNewEmails()},3e4)},I.updateEmailFromModal=function(e){angular.forEach(e,function(e){I.removeEmail(e)})},I.updateCssFromModal=function(e){angular.forEach(e,function(e){var o="email"+e,n=document.getElementById(o);null!=n&&(n.style.backgroundColor="#eee")})}}angular.module("newsletterApp").controller("inboxController",e),e.$inject=["$q","dataService","authService","sqlLiteService","$ionicPopover","$filter","$ionicSideMenuDelegate","$scope","$timeout","$ionicHistory","$state","$ionicScrollDelegate"]}();
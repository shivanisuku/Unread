!function(){"use strict";function e(e,n,i,t,s,o,r,a,l,g,c,u){function d(){var e=l.defer();f.signupIds=[],f.signupIdsCategory=[];var n=!1;return a.getMemberNewsletterCategoryIdsFromDeviceDB().then(function(i){!angular.isUndefined(i)&&i.length?(f.signupIds=[],angular.forEach(i,function(e){f.signupIdsCategory.push(e),angular.forEach(e.nlIds,function(e){f.signupIds.push(e)})}),n=!0,e.resolve(n)):e.resolve(n)}),e.promise}function p(e){f.newsletters=[],f.category=[],f.categoryData=[],a.getNewsLetterCategoriesFromDeviceDB(!1).then(function(e){if(null==e||angular.isUndefined(e.categories)||null==e.categories)f.showloading=!1,console.log("No data is available");else{f.categoryData=e;var n=[{id:0,name:"All",orderNumber:1,iconName:"ion-ios-world"}];f.category.push(n),angular.forEach(e.categories,function(e){f.category[0].push(e)}),angular.forEach(f.category[0],function(e,n){var i=r("filter")(f.signupIdsCategory,{cId:e.id},!0),t=[];0==e.id&&(t=f.signupIds.slice(0,10)),!angular.isUndefined(i)&&i.length&&(t=[],t=i[0].nlIds),a.getNewslettersFromDeviceDB(e.id,10,t).then(function(n){var i=0,t=[];if(null!=n&&!angular.isUndefined(n.newsletterSignup)&&null!=n.newsletterSignup&&n.newsletterSignup.length>0){angular.forEach(n.newsletterSignup,function(e){!angular.isUndefined(f.signupIds)&&f.signupIds.length&&f.signupIds.indexOf(e.id)>-1&&(i+=1,t.push({nl:e,nlOrder:i}))}),angular.forEach(n.newsletterSignup,function(e){(angular.isUndefined(f.signupIds)||0===f.signupIds.length||f.signupIds.length&&-1===f.signupIds.indexOf(e.id))&&(i+=1,t.push({nl:e,nlOrder:i}))});var s={category:e,newsletters:t,order:e.orderNumber};f.newsletters.push(s),f.showloading=!1}})})}})}e.broadcastNetworkAvailability();var f=this;f.signupIds=[],f.signupIdsCategory=[],f.newsletters=[],f.category=[],f.categoryData=[],f.active=-1,f.checkboxRequired=!1,f.showloading=!0,g.$on("$ionicView.beforeEnter",function(e,n){a.initNewsletterCategory().then(function(e){d().then(function(e){p(1),angular.isDefined(localStorage.cId)&&null!=localStorage.cId&&localStorage.cId.length&&(f.active=parseInt(localStorage.cId),console.log(f.active))})})}),f.setSelectedList=function(e,n){var i=f.signupIds.indexOf(e);i>-1?f.signupIds.splice(i,1):f.signupIds.push(e);var t=r("filter")(f.signupIdsCategory,{cId:n},!0);if(console.log(n),!angular.isUndefined(t)&&t.length){var s=f.signupIdsCategory.indexOf(t[0]),o=t[0].nlIds,a=o.indexOf(e);a>-1?o.splice(a,1):o.push(e),t[0].nlIds=o,t[0].nlIds.length<1?f.signupIdsCategory.splice(s,1):f.signupIdsCategory[s]=angular.copy(t[0])}else{var o=[];o.push(e),f.signupIdsCategory.push({cId:n,nlIds:o})}},f.activateCategory=function(e){if(e===f.active)f.active=-1,o.scrollTop();else{f.active=e;var n=r("filter")(f.category[0],{id:e},!0);null!=n&&f.category[0].indexOf(n[0])==f.category[0].length-1?u(function(){o.scrollBottom(!0)},200):o.scrollBy(0,80,!0)}},f.moreCategory=function(e){localStorage.cId=e,a.insertMemberNewsletterToDeviceDB(f.signupIdsCategory,!0).then(function(s){n.saveMemberSignupList(f.signupIds).then(function(n){if(!angular.isUndefined(n.isSuccessful)&&!n.isSuccessful&&n.saveToApiLog){var s={signupIds:f.signupIds,cId:0},o={memberId:0,apiCallType:"sub",dataObject:JSON.stringify(s)};a.InsertIntoApiFailedLog(o)}t.nextViewOptions({historyRoot:!0}),i.transitionTo("app.subscription-category",{id:e})})})},f.gotoInbox=function(){t.nextViewOptions({historyRoot:!0}),i.go("app.inbox")},g.$on("$locationChangeStart",function(e,i,t){t.indexOf("subscription")>-1&&-1===t.indexOf("subscription-category")&&-1===i.indexOf("subscription-category")&&(a.insertMemberNewsletterToDeviceDB(f.signupIdsCategory,!0).then(function(e){n.saveMemberSignupList(f.signupIds).then(function(e){if(!angular.isUndefined(e.isSuccessful)&&!e.isSuccessful&&e.saveToApiLog){var n={signupIds:f.signupIds,cId:0},i={memberId:0,apiCallType:"sub",dataObject:JSON.stringify(n)};a.InsertIntoApiFailedLog(i)}})}),localStorage.cId="")})}angular.module("newsletterApp").controller("subscriptionController",e),e.$inject=["authService","dataService","$state","$ionicHistory","$window","$ionicScrollDelegate","$filter","sqlLiteService","$q","$scope","$rootScope","$timeout"]}();
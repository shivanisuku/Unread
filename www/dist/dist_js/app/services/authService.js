function authService(e,o,r,n,t){function a(){return window.Connection?navigator.connection.type==Connection.NONE?!1:!0:window.navigator.onLine}function s(){return window.Connection?navigator.connection.type==Connection.NONE?(r.$broadcast("networkAvailable",!1),!1):!0:(r.$broadcast("networkAvailable",window.navigator.onLine),window.navigator.onLine)}function i(){if(!angular.isUndefined(localStorage.oAuth)&&localStorage.oAuth.length>0){var e=JSON.parse(localStorage.oAuth);return null!=e&&!angular.isUndefined(e)&&e.access_token.length>0?!0:!1}return!1}function c(t,a){var s=o.defer(),i=n.login;return e({method:"POST",url:i,headers:{"Content-Type":"application/x-www-form-urlencoded"},data:"userName="+encodeURIComponent(t)+"&password="+encodeURIComponent(a)+"&grant_type=password"}).success(function(e){if(e.access_token.length>0){e.email=t,e.password=a;var o=new Date;e.expiry=o.setDate(o.getDate()+28),l(e),r.$broadcast("user:loggedIn",e),s.resolve(e)}s.resolve(!1)}).error(function(e){var o={};o.email=t,o.password=a,o.access_token=null,o.error_description="An error has occured in api",null!=e&&(o.error_description=e.error_description),console.log(e),s.resolve(o)}),s.promise}function l(e){localStorage.oAuth="",localStorage.oAuth=JSON.stringify(e)}function u(){return localStorage.removeItem("oAuth"),r.$broadcast("user:loggedOut",!0),!0}function d(){if(!angular.isUndefined(localStorage.oAuth)&&localStorage.oAuth.length>0){var e=JSON.parse(localStorage.oAuth);if(!(e.expiry<Date.now()&&a()))return JSON.parse(localStorage.oAuth);c(e.email,e.password).then(function(e){return JSON.parse(localStorage.oAuth)})}return null}function g(r){var t=h+n.checkEmail+r;console.log(t);var a=o.defer();return e.get(t).success(function(e){a.resolve(e)}).error(function(e){console.log(e),a.resolve(e)}),a.promise}function f(r){var t=h+n.saveMember,s=o.defer();return e({method:"POST",url:t,headers:{"Content-Type":"application/json"},data:r}).success(function(e){s.resolve(e)}).error(function(e){e={isSuccessful:!1,message:"An error has occured please retry again"},a()||(e=r.id<1?{isSuccessful:!1,message:"Please check your internet connection and try again."}:{isSuccessful:!1,message:"",saveToApiLog:!0}),s.resolve(e)}),s.promise}function p(){var r=o.defer(),t=d();if(angular.isUndefined(t)||null==t)r.reject();else{var a=t.member_id,s="Bearer "+t.access_token;console.log(s);var i={"Content-Type":"application/json",Authorization:s},c=h+n.getMemberById.replace("[[mid]]",a);e.get(c,{headers:i}).then(function(e){r.resolve(e.data)},function(e){r.resolve(e.data)})}return r.promise}function v(r){var t=o.defer(),a=h+n.forgotPassword+r;return e.get(a).success(function(e){t.resolve(e)}).error(function(e){e={isSuccessful:!1,message:"An error has occured please retry again"},authService.isNetworkAvailable()||(e={isSuccessful:!1,message:"Please check your internet connection and try again or email to support@unreadapp.com"}),t.resolve(e)}),t.promise}var h=n.url;e.defaults.headers.put={"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET, POST, PUT, DELETE, OPTIONS","Access-Control-Allow-Headers":"Origin,Content-Type, X-Requested-With,Accept"},e.defaults.useXDomain=!0;var m={isAuthenticated:i,logout:u,CheckEmailAddressAvailability:g,SaveMember:f,GetMemberById:p,getoAuth:d,isNetworkAvailable:a,login:c,forgotPassword:v,broadcastNetworkAvailability:s};return m}angular.module("newsletterApp").factory("authService",authService),authService.$inject=["$http","$q","$rootScope","envVariables","$cordovaNetwork"];
function sqlLiteService(e,t,r,o,n,i,a,s,l){function d(){null===db&&(window.cordova?db=o.openDB({name:"newsletterDB"}):db=window.openDatabase("newsletterDB","1","newsletterDB",104857600)),o.execute(db,"CREATE TABLE IF NOT EXISTS member(id integer primary key,email text , firstName text ,lastName text,phone text,mobileNo text,gender text,postalCode text,password ,language text,birthday text)"),o.execute(db,"CREATE TABLE IF NOT EXISTS category(id integer primary key,name text,orderNumber integer,iconName text,syncdate text)"),o.execute(db,"CREATE TABLE IF NOT EXISTS newsletter(id integer primary key,clientId integer,categoryId integer,pointId integer,signupAddress text,domainName text ,imagePath text ,orderNumber integer,syncdate text)"),o.execute(db,"CREATE TABLE IF NOT EXISTS memberNewsletters(id integer primary key,memberId integer,categoryId integer,newsletters text,syncdate text)"),o.execute(db,"CREATE TABLE IF NOT EXISTS newsletterEmail(emailid integer primary key,memberId integer,categoryId integer,newsletterSignupId integer,subject text,fromEmail text ,createdDate text,emailSendingDate text,emailBody text,imagePath text,statusName text,pointforSave integer,pointforNotInterest integer,pointforFeedback integer,pointforShare integer,opened integer)"),o.execute(db,"CREATE TABLE IF NOT EXISTS trendingEmail(emailid integer primary key,memberId integer,categoryId integer,newsletterSignupId integer,subject text,fromEmail text ,createdDate text,emailSendingDate text,emailBody text,imagePath text,statusName text,pointforSave integer,pointforNotInterest integer,pointforFeedback integer,pointforShare integer,opened integer)"),o.execute(db,"CREATE TABLE IF NOT EXISTS ApiFailedLog(id integer primary key AUTOINCREMENT,memberId integer,apiCallType text,dataObject text,created text)")}function m(t){var r=e.defer(),n=!1,i="INSERT INTO member (id , email , firstName ,lastName ,phone ,mobileNo,gender ,postalCode,password ,language,birthday) VALUES (?,?,?,?,?,?,?,?,?,?,?)";return o.execute(db,i,[t.id,t.email,t.firstName,t.lastName,t.phone,t.mobileNo,t.gender,t.postalCode,t.password,t.language,t.birthday]).then(function(e){console.log("INSERT ID -> "+e.insertId),n=!0,r.resolve(n)},function(e){console.log(e),r.resolve(n)}),r.promise}function c(){var t=e.defer(),r=n.getoAuth(),a=r.member_id,l=null,d="SELECT email , firstName ,lastName ,phone ,mobileNo,gender ,postalCode,password ,language,birthday FROM member WHERE id = ?";return o.execute(db,d,[a]).then(function(e){if(e.rows.length>0)l={email:e.rows.item(0).email,firstName:e.rows.item(0).firstName,lastName:e.rows.item(0).lastName,postalCode:e.rows.item(0).postalCode,password:e.rows.item(0).password,phone:e.rows.item(0).phone,province:"",city:"",mobileNo:e.rows.item(0).mobileNo,gender:e.rows.item(0).gender,language:e.rows.item(0).language,birthyear:f(e.rows.item(0).birthday,0),birthmonth:f(e.rows.item(0).birthday,1),birthdate:f(e.rows.item(0).birthday,2),id:a},t.resolve(l);else{n.GetMemberById().then(function(e){console.log("m not available"),angular.isUndefined(e)||null==e?n.logout():m(e).then(function(e){e&&(i.getMemberNewsletter().then(function(e){if(console.log(" nl recvd"),console.log(e),console.log(e.data.memberNewsletterSignupList),angular.isDefined(e.data.memberNewsletterSignupList)&&e.data.memberNewsletterSignupList.length){var t=[];angular.forEach(e.data.memberNewsletterSignupList,function(e){var r=e.newsletterSignupId,o=e.categoryId,n=s("filter")(t,{cId:o},!0);if(!angular.isUndefined(n)&&n.length){var i=t.indexOf(n[0]),a=n[0].nlIds,l=a.indexOf(r);l>-1||a.push(r),n[0].nlIds=a,n[0].nlIds.length<1?t.splice(i,1):t[i]=angular.copy(n[0])}else{var a=[];a.push(r),t.push({cId:o,nlIds:a})}}),console.log(t),R(t,!0)}}),c().then(function(e){console.log(e),t.resolve(e)}))})});console.log("No results found"),t.resolve(l)}},function(e){console.error(e),t.resolve(l)}),t.promise}function u(t){var r=e.defer(),n=!1,i="UPDATE member SET  email=(?) , firstName=(?) ,lastName=(?) ,phone=(?) ,mobileNo=(?),gender=(?) ,postalCode=(?),password=(?) ,language=(?),birthday=(?) WHERE id = (?)";return o.execute(db,i,[t.email,t.firstName,t.lastName,t.phone,t.mobileNo,t.gender,t.postalCode,t.password,t.language,t.birthday,t.id]).then(function(e){n=!0,r.resolve(n)},function(e){r.resolve(n)}),r.promise}function f(e,t){return angular.isUndefined(e)||null==e?null:parseInt(e.split(/-/)[t],10)}function g(t,r){var n=e.defer(),i=null,a="SELECT  id, email ,password  FROM member WHERE email = (?) and password=(?)";return o.execute(db,a,[t,r]).then(function(e){e.rows.length>0?(i={success:!0,email:e.rows.item(0).email,password:e.rows.item(0).password,id:e.rows.item(0).id},n.resolve(i)):(i={success:!1,message:"Email and Password does not match"},n.resolve(i))}),n.promise}function E(r,o){var i=e.defer();return n.isNetworkAvailable()?n.login(r,o).then(function(e){H(),i.resolve(e)},function(e){i.resolve(e)}):g(r,o).then(function(e){if(e.success){var n=new Date;n.setDate(n.getDate()+1);var a={email:r,password:o,access_token:e.id.toString(),member_id:e.id,expiry:n};localStorage.oAuth="",localStorage.oAuth=JSON.stringify(a),t.$broadcast("user:loggedIn",e),H(),i.resolve(a)}else{var a={email:r,password:o,access_token:"",error_description:"The internet is disconnected on your device.Connect to internet and try again"};H(),i.resolve(a)}}),i.promise}function b(){o.execute(db,"CREATE INDEX IF NOT EXISTS _indexUniqueId  ON newsletter (categoryId)").then(function(){},function(e){console.log(e)}),o.execute(db,"CREATE INDEX IF NOT EXISTS _indexUniqueStatus  ON newsletterEmail (statusName)").then(function(){},function(e){console.log(e)}),o.execute(db,"CREATE INDEX IF NOT EXISTS _indexUniqueMemberId  ON newsletterEmail (memberId)").then(function(){},function(e){console.log(e)})}function p(){b();var t=e.defer(),r=[],n=!0,i="SELECT id ,name,orderNumber,iconName,syncdate FROM category",a=Math.floor(Date.now()/1e3);return o.execute(db,i).then(function(e){n=e.rows.length>0?a-e.rows.item(0).syncdate<1e4?!0:!1:!0}),console.log(n),n?v(!0).then(function(o){if(null!=o){var n=o.categories,i=1;angular.forEach(n,function(o,a){N(o.id,!0).then(function(o){r.push(!0),i==n.length&&(e.all(r),t.resolve(!0)),i++},function(e){console.log(e)})})}else t.resolve(!1)}):(r.push(!0),e.all(r),t.resolve(!0)),t.promise}function h(t){var r=e.defer(),n=[];return angular.forEach(t,function(e){var t=(new Date,Math.floor(Date.now()/1e3)),i="INSERT INTO category (id ,name,orderNumber,iconName,syncdate) VALUES (?,?,?,?,?)";o.execute(db,i,[e.id,e.name,e.orderNumber,e.iconName,t]).then(function(e){console.log("INSERT ID -> "+e.insertId),n.push(!0)},function(e){console.log(e),r.resolve(!0)})}),e.all(n),r.resolve(!0),r.promise}function v(t){var r=[],n=e.defer(),i=null,a="SELECT id ,name,orderNumber,iconName,syncdate FROM category",s=Math.floor(Date.now()/1e3);return o.execute(db,a).then(function(e){if(e.rows.length>0)if(t)if(s-e.rows.item(0).syncdate<1e4){console.log("hours do  match");for(var o=0;o<e.rows.length;o++){var a=e.rows.item(o);r.push(a)}i={categories:r},n.resolve(i)}else console.log("hours do not match"),w(1).then(function(e){e?v(!1).then(function(e){n.resolve(e)}):n.resolve(i)});else{for(var o=0;o<e.rows.length;o++){var a=e.rows.item(o);r.push(a)}i={categories:r},n.resolve(i)}else console.log("No records in Db"),w(1).then(function(e){console.log(e),e?v(!1).then(function(e){console.log(e),n.resolve(e)}):n.resolve(i)})},function(e){console.log(e),n.resolve(i)}),n.promise}function w(t){var r=e.defer(),n=!0;return i.getNewsletterCategory(t).then(function(e){console.log(e),angular.isUndefined(e.categories)||null==e||!e.isSuccessful?(console.log("No data is available gh"),n=!1,r.resolve(n)):(1===t&&o.execute(db,"delete from category"),h(e.categories).then(function(t){e.currentPage<e.totalPages?w(e.currentPage+1):(n=!0,r.resolve(n))}))}),r.promise}function I(t){var r=e.defer(),n=null,i="SELECT id ,name,orderNumber,iconName,syncdate FROM category where id=(?)";Math.floor(Date.now()/1e3);return o.execute(db,i,[t]).then(function(e){e.rows.length>0&&(n=e.rows.item(0),r.resolve(n))},function(e){console.log(e),r.resolve(n)}),r.promise}function N(t,r){var n=e.defer(),i=null,a="SELECT id,clientId,categoryId ,pointId,signupAddress,domainName,imagePath,orderNumber,syncdate FROM newsletter WHERE categoryId = (?) ORDER BY orderNumber";return o.execute(db,a,[t]).then(function(e){if(e.rows.length>0){var o=Math.floor(Date.now()/1e3),a=[];if(r)if(o-e.rows.item(0).syncdate<5e4){console.log("hours do  match");for(var s=0;s<e.rows.length;s++){var l=e.rows.item(s);a.push(l)}i={newsletterSignup:a},n.resolve(i)}else console.log("hours do not match"),T(t).then(function(e){e&&N(t,!1).then(function(e){n.resolve(e)})});else{for(var s=0;s<e.rows.length;s++){var l=e.rows.item(s);a.push(l)}i={newsletterSignup:a},n.resolve(i)}}else console.log("No records in Db"),T(t).then(function(e){e?N(t,!1).then(function(e){n.resolve(e)}):n.resolve(e)})},function(e){console.log(e),n.resolve(i)}),n.promise}function S(t,r,o){var n=e.defer(),i=null,a=[];return D(t,r,o,!1).then(function(e){null!=e&&(a=e),null!=o&&o.length>0&&o.length<11?D(t,r,o,!0).then(function(e){null!=e?(angular.forEach(e,function(e){a.push(e)}),i={newsletterSignup:a},n.resolve(i)):(i={newsletterSignup:a},n.resolve(i))}):(i={newsletterSignup:a},n.resolve(i))},function(e){n.resolve(i)}),n.promise}function D(t,r,n,i){var a=e.defer(),s=null,l="SELECT id,clientId,categoryId ,pointId,signupAddress,domainName,imagePath,orderNumber,syncdate FROM newsletter ";return t>0&&(l=l+" WHERE categoryId ="+t),null!=n&&n.length>0&&(l+=t>0?" And ":" where ",l=i?l+" id not  in ("+n+")":l+" id in ("+n+")"),l+=t>0?" ORDER BY orderNumber ":" ORDER BY imagePath ",r>0&&(l=l+" Limit "+r),o.execute(db,l).then(function(e){if(e.rows.length>0){for(var t=[],r=0;r<e.rows.length;r++){var o=e.rows.item(r);t.push(o)}s=t,a.resolve(s)}else console.log("No records in Db"),a.resolve(s)},function(e){console.log(e),a.resolve(s)}),a.promise}function y(t){var r=e.defer(),n=[];return angular.forEach(t,function(e){var t=(new Date,Math.floor(Date.now()/1e3)),r="INSERT INTO newsletter (id ,clientId ,categoryId ,pointId ,signupAddress ,domainName ,imagePath,orderNumber ,syncdate) VALUES (?,?,?,?,?,?,?,?,?)";o.execute(db,r,[e.id,e.clientId,e.categoryId,e.pointId,e.signupAddress,e.domainName,e.imagePath,e.orderNumber,t]),n.push(!0)}),e.all(n),r.resolve(!0),r.promise}function T(t){var r=e.defer(),n=!0;return i.getNewsletters(t,1e3).then(function(e){if(!angular.isUndefined(e.newsletterSignup)&&e.newsletterSignup.length>0){var i="delete  from newsletter where categoryId=(?)";o.execute(db,i,[t]),y(e.newsletterSignup).then(function(e){n=!0,r.resolve(n)})}else r.resolve(n)}),r.promise}function R(t,r){var i=e.defer(),a=n.getoAuth(),s=a.member_id;if(r){var l="DELETE FROM memberNewsletters WHERE memberId = (?)";o.execute(db,l,[s]).then(function(){console.log("deleted")})}if(angular.isUndefined(t))i.resolve(!0);else{var d=[],m=Math.floor(Date.now()/1e3);angular.forEach(t,function(e){var t="INSERT INTO memberNewsletters (memberId ,categoryId ,newsletters ,syncdate) VALUES (?,?,?,?)";o.execute(db,t,[s,e.cId,e.nlIds,m]).then(function(){},function(e){console.log(e)}),d.push(!0)}),e.all(d),i.resolve(!0)}return i.promise}function A(t,r){var i=e.defer(),a=n.getoAuth(),s=a.member_id;if(angular.isUndefined(t))i.reject();else{var l="DELETE FROM memberNewsletters WHERE memberId =(?) AND categoryId = (?)";o.execute(db,l,[s,r]);var d=[],m=Math.floor(Date.now()/1e3);if(t.length>0){var c="INSERT INTO memberNewsletters (memberId ,categoryId ,newsletters ,syncdate) VALUES (?,?,?,?)";o.execute(db,c,[s,r,t,m])}d.push(!0),e.all(d),i.resolve(!0)}return i.promise}function x(t){var r=e.defer(),i=n.getoAuth(),a=i.member_id,s=[],l="SELECT newsletters FROM memberNewsletters WHERE memberId = (?)";return t>0?(l="SELECT newsletters FROM memberNewsletters WHERE memberId =(?) AND categoryId = (?)",o.execute(db,l,[a,t]).then(function(e){if(e.rows.length>0){for(var t=e.rows.item(0),o=t.newsletters,n=o.split(",").map(function(e){return Number(e)}),i=0;i<n.length;i++)s.push(n[i]);r.resolve(s)}else r.resolve(s)},function(e){r.resolve(s)})):o.execute(db,l,[a]).then(function(e){if(e.rows.length>0){for(var t=0;t<e.rows.length;t++)for(var o=e.rows.item(t).newsletters,n=o.split(",").map(function(e){return Number(e)}),i=0;i<n.length;i++)s.push(n[i]);r.resolve(s)}else r.resolve(s)},function(e){console.log(e),r.resolve(s)}),r.promise}function O(){var t=e.defer(),r=n.getoAuth(),i=r.member_id,a=[],s="SELECT categoryId,newsletters FROM memberNewsletters WHERE memberId = (?)";return o.execute(db,s,[i]).then(function(e){for(var r=0;r<e.rows.length;r++){var o=e.rows.item(r),n=o.newsletters,i=n.split(",").map(function(e){return Number(e)});a.push({cId:o.categoryId,nlIds:i})}t.resolve(a)},function(e){console.log(e),t.resolve(a)}),t.promise}function L(t,r){var i=e.defer(),a=n.getoAuth(),s=a.member_id,l={result:!1},d="SELECT categoryId,newsletters FROM memberNewsletters WHERE memberId = (?) AND  categoryId = (?)";return o.execute(db,d,[s,r]).then(function(e){if(e.rows.length>0){var r=e.rows.item(0).newsletters,o=r.split(",").map(function(e){return Number(e)});o.indexOf(t)>-1?(l={result:!0},i.resolve(l)):i.resolve(l)}else i.resolve(l)},function(e){console.log(e),i.resolve(l)}),i.promise}function C(){var t=e.defer(),r=n.getoAuth();if(!angular.isUndefined(r)&&r.member_id>0){var i=r.member_id,a=0,s="SELECT emailid  FROM newsletterEmail WHERE memberId = (?)ORDER BY emailid DESC LIMIT 1";o.execute(db,s,[i]).then(function(e){e.rows.length>0&&(a=e.rows.item(0).emailid),F(a).then(function(e){e?t.resolve(a):t.resolve(0)})},function(e){console.log(e),t.resolve(a)})}else t.resolve(a);return t.promise}function F(t){var r=e.defer(),n=[];return i.getMemberNewsletterEmails(t).then(function(t){t.msg.isSuccessful&&t.memberNewsletterEmailList.length>0?(angular.forEach(t.memberNewsletterEmailList,function(e){var t="INSERT INTO newsletterEmail(emailid ,memberId ,categoryId ,newsletterSignupId ,subject ,fromEmail  ,createdDate ,emailSendingDate ,emailBody ,imagePath ,statusName ,pointforSave ,pointforNotInterest ,pointforFeedback ,pointforShare,opened ) VALUES (?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)";o.execute(db,t,[e.emailid,e.memberId,e.categoryId,e.newsletterSignupId,e.subject,e.fromEmail,e.createdDate,e.emailSendingDate,e.emailBody,e.imagePath,e.statusName,e.pointforSave,e.pointforNotInterest,e.pointforFeedback,e.pointforShare,0]).then(function(e){n.push(!0)},function(e){console.log(e),n.push(!0)})}),e.all(n),r.resolve(!0)):r.resolve(!1)}),r.promise}function M(r,i,a){var s=e.defer(),l=null,d=n.getoAuth(),m=[],c=10*(i-1);if(c=isNaN(c)?0:c,!angular.isUndefined(d)&&d.member_id>0){var u=d.member_id,f="select statusName,count(*)  total from newsletterEmail WHERE memberId = (?)  AND opened=0 group by statusName";o.execute(db,f,[u]).then(function(e){if(e.rows.length>0)for(var r=0;r<e.rows.length;r++)"Inbox"===e.rows.item(r).statusName&&t.$broadcast("UnreadCount",e.rows.item(r).total),"Save"===e.rows.item(r).statusName&&t.$broadcast("UnreadCountSaved",e.rows.item(r).total)},function(e){console.log(e)});var g="SELECT emailid ,emailBody,memberId ,categoryId ,newsletterSignupId ,subject ,fromEmail  ,createdDate ,emailSendingDate,imagePath ,statusName ,pointforSave ,pointforNotInterest ,pointforFeedback ,pointforShare ,opened FROM newsletterEmail WHERE memberId = (?) AND statusName = (?) ";a>0&&(g=g+"And emailId < "+a),g=g+"  ORDER BY emailid DESC  LIMIT 10 OFFSET "+c,o.execute(db,g,[u,r]).then(function(e){if(e.rows.length>0){for(var t=0;t<e.rows.length;t++){var r=e.rows.item(t);m.push(r)}l=m,s.resolve(l)}else s.resolve(l)},function(e){console.log(e),s.resolve(l)})}else s.resolve(l);return s.promise}function B(t,r){var i=e.defer(),a=null,s=n.getoAuth(),l=[];if(!angular.isUndefined(s)&&s.member_id>0){var d=s.member_id;H();var m="SELECT emailid,emailBody ,memberId ,categoryId ,newsletterSignupId ,subject ,fromEmail  ,createdDate ,emailSendingDate,imagePath ,statusName ,pointforSave ,pointforNotInterest ,pointforFeedback ,pointforShare FROM newsletterEmail WHERE memberId = (?) AND statusName = (?) ";r>0&&(m=m+"And emailId > "+r),m+="  ORDER BY emailid  ",o.execute(db,m,[d,t]).then(function(e){if(e.rows.length>0){for(var t=0;t<e.rows.length;t++){var r=e.rows.item(t);l.push(r)}a=l,i.resolve(a)}else i.resolve(a)},function(e){console.log(e),i.resolve(a)})}else i.resolve(a);return i.promise}function U(t,r){var i=n.getoAuth(),a="Inbox";2===r&&(a="Save"),3===r&&(a="Delete");var s=e.defer(),l=!1;if(null!=i){var d=(i.member_id,"UPDATE newsletterEmail SET statusName=(?)  WHERE emailid = (?)");o.execute(db,d,[a,t]).then(function(e){l=!0,H(),s.resolve(l)},function(e){s.resolve(l)})}return s.promise}function H(){var e=n.getoAuth();if(null!=e){var r=e.member_id,i="select count(*)  total from newsletterEmail WHERE memberId = (?)  AND opened=0  And statusName='Inbox'";o.execute(db,i,[r]).then(function(e){e.rows.length>0?t.$broadcast("UnreadCount",e.rows.item(0).total):t.$broadcast("UnreadCount",0)},function(e){console.log(e)});var a="select count(*)  total from newsletterEmail WHERE memberId = (?)  AND opened=0  And statusName='Save'";o.execute(db,a,[r]).then(function(e){e.rows.length>0?t.$broadcast("UnreadCountSaved",e.rows.item(0).total):t.$broadcast("UnreadCountSaved",0)},function(e){console.log(e)})}else t.$broadcast("UnreadCount",0),t.$broadcast("UnreadCountSaved",0)}function W(){var t=e.defer(),r=n.getoAuth(),a=r.member_id;return i.getTrendingNewsletters().then(function(e){if(!angular.isUndefined(e)&&e.msg.isSuccessful&&e.memberNewsletterEmailList.length>0){var r="DELETE from trendingEmail where memberId=(?)";o.execute(db,r,[a]),angular.forEach(e.memberNewsletterEmailList,function(e){var t="INSERT INTO trendingEmail(emailid ,memberId ,categoryId ,newsletterSignupId ,subject ,fromEmail  ,createdDate ,emailSendingDate ,emailBody ,imagePath ,statusName ,pointforSave ,pointforNotInterest ,pointforFeedback ,pointforShare,opened ) VALUES (?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)";o.execute(db,t,[e.emailid,e.memberId,e.categoryId,e.newsletterSignupId,e.subject,e.fromEmail,e.createdDate,e.emailSendingDate,e.emailBody,e.imagePath,e.statusName,e.pointforSave,e.pointforNotInterest,e.pointforFeedback,e.pointforShare,0]).then(function(e){},function(e){console.log(e)})}),t.resolve(!0)}else t.resolve(!0)}),t.promise}function _(t){var r=e.defer(),i=null,a=n.getoAuth(),s=[];if(!angular.isUndefined(a)&&a.member_id>0){var l=a.member_id,d="SELECT emailid ,memberId ,categoryId ,newsletterSignupId ,subject ,fromEmail  ,createdDate ,emailSendingDate ,emailBody ,imagePath ,statusName ,pointforSave ,pointforNotInterest ,pointforFeedback ,pointforShare,opened FROM trendingEmail WHERE memberId = (?) ORDER BY emailid DESC ";o.execute(db,d,[l]).then(function(e){if(e.rows.length>0){for(var o=0;o<e.rows.length;o++){var n=e.rows.item(o);s.push(n)}i=s,r.resolve(i)}else t?W().then(function(e){e?_(!1).then(function(e){r.resolve(e)}):r.resolve(i)}):r.resolve(i)},function(e){console.log(e),r.resolve(!1)})}return r.promise}function k(t,r){var i=e.defer(),a=null,s=0,l=n.getoAuth(),d=l.member_id,m="SELECT emailid ,memberId ,categoryId ,newsletterSignupId ,subject ,fromEmail  ,createdDate ,emailSendingDate ,emailBody ,imagePath ,statusName ,pointforSave ,pointforNotInterest ,pointforFeedback ,pointforShare FROM newsletterEmail WHERE memberId = (?) AND emailid=(?) AND statusName = (?) ORDER BY emailid DESC ",c="SELECT emailid ,memberId ,categoryId ,newsletterSignupId ,subject ,fromEmail  ,createdDate ,emailSendingDate ,emailBody ,imagePath ,statusName ,pointforSave ,pointforNotInterest ,pointforFeedback ,pointforShare FROM newsletterEmail WHERE memberId = (?)  AND emailid < (?)  AND statusName = (?)ORDER BY emailid DESC LIMIT 1",u=[d,t,r];return"Trending"===r&&(m="SELECT emailid ,memberId ,categoryId ,newsletterSignupId ,subject ,fromEmail  ,createdDate ,emailSendingDate ,emailBody ,imagePath ,statusName ,pointforSave ,pointforNotInterest ,pointforFeedback ,pointforShare FROM trendingEmail WHERE memberId = (?)  AND emailid=(?) ",c="SELECT emailid ,memberId ,categoryId ,newsletterSignupId ,subject ,fromEmail  ,createdDate ,emailSendingDate ,emailBody ,imagePath ,statusName ,pointforSave ,pointforNotInterest ,pointforFeedback ,pointforShare  FROM trendingEmail WHERE memberId = (?)  AND emailid < (?) ORDER BY emailid DESC LIMIT 1",u=[d,t]),o.execute(db,m,u).then(function(e){e.rows.length>0?o.execute(db,c,u).then(function(t){s=t.rows.length>0?t.rows.item(0):null,a={email:e.rows.item(0),prevEmail:s},i.resolve(a)},function(e){console.log(e),i.resolve(a)}):i.resolve(a)},function(e){console.log(e),i.resolve(a)}),i.promise}function P(t){var r=e.defer(),i=null,a=n.getoAuth(),s=a.member_id,l="SELECT emailBody  FROM newsletterEmail WHERE memberId = (?) AND emailid=(?)  ORDER BY emailid DESC ",d=[s,t];return"Trending"===status&&(l="SELECT emailBody  FROM trendingEmail WHERE memberId = (?)  AND emailid=(?) "),o.execute(db,l,d).then(function(e){e.rows.length>0?(i={emailBody:e.rows.item(0).emailBody},r.resolve(i)):r.resolve(i)},function(e){console.log(e),r.resolve(i)}),r.promise}function j(t,r){var i=e.defer(),a=!1,s=n.getoAuth(),l=s.member_id,d="SELECT * FROM memberNewsletters WHERE memberId = (?)  AND  categoryId = (?)";return o.execute(db,d,[l,r]).then(function(e){if(e.rows.length>0){var n=e.rows.item(0).newsletters;if(n.indexOf(t)>-1){var s=n.split(",").map(function(e){return Number(e)}),d=s.indexOf(t);s.splice(d,1);var m="UPDATE memberNewsletters  set newsletters =(?) WHERE memberId = (?)  AND  categoryId = (?)";o.execute(db,m,[s,l,r]).then(function(e){a=!0,i.resolve(a)},function(e){console.log(e)})}else a=!0,i.resolve(a)}else a=!0,i.resolve(a)},function(e){console.log(e),i.resolve(a)}),i.promise}function $(){var t=e.defer(),r=n.getoAuth(),i=0,a="SELECT count(*) Total  FROM newsletterEmail WHERE memberId = (?)";return o.execute(db,a,[r.member_id]).then(function(e){e.rows.length>0?(i=e.rows.item(0).Total,t.resolve(i)):t.resolve(i)},function(e){console.log(e),t.resolve(i)}),t.promise}function Y(t,r){var i=e.defer(),a=n.getoAuth(),s="Update newsletterEmail set opened =1  WHERE memberId = (?) AND emailid=(?) AND statusName = '"+r+"' And opened=0 ";return"Trending"===r&&(s="Update trendingEmail set opened =1  WHERE memberId = (?) AND emailid=(?)  And opened=0 "),o.execute(db,s,[a.member_id,t]).then(function(e){i.resolve(!0)},function(e){console.log(e),i.resolve(!0)}),H(),i.promise}function X(t,r){var i=e.defer(),a=null,s=n.getoAuth(),l=s.member_id,d=[],m=[],c="SELECT * from(SELECT emailid ,memberId ,categoryId ,newsletterSignupId ,subject ,fromEmail  ,createdDate ,emailSendingDate,imagePath ,statusName ,pointforSave ,pointforNotInterest ,pointforFeedback ,pointforShare ,opened , 2 rank FROM newsletterEmail WHERE memberId = "+l+"  AND statusName = '"+r+"' And ( Lower(subject) LIKE '%"+t.toLowerCase()+"%'   )";return c=c+" UNION SELECT emailid ,memberId ,categoryId ,newsletterSignupId ,subject ,fromEmail  ,createdDate ,emailSendingDate,imagePath ,statusName ,pointforSave ,pointforNotInterest ,pointforFeedback ,pointforShare ,opened , 1 rank  FROM newsletterEmail WHERE memberId = "+l+"  AND statusName = '"+r+"' And (  Lower(fromEmail) LIKE '%"+t.toLowerCase()+"%'   )",c=c+" UNION SELECT emailid ,memberId ,categoryId ,newsletterSignupId ,subject ,fromEmail  ,createdDate ,emailSendingDate,imagePath ,statusName ,pointforSave ,pointforNotInterest ,pointforFeedback ,pointforShare ,opened , 3 rank  FROM newsletterEmail WHERE memberId = "+l+"  AND statusName = '"+r+"' And (  Lower(emailBody) LIKE '%"+t.toLowerCase()+"%' ) ) ORDER BY rank ",o.execute(db,c).then(function(e){if(e.rows.length>0)for(var t=0;t<e.rows.length;t++){var r=e.rows.item(t);m.indexOf(r.emailid)<0&&(d.push(r),m.push(r.emailid))}a=d,i.resolve(a)},function(e){console.log(e),a=d,i.resolve(a)}),i.promise}function V(t,r){var i=e.defer(),a=null,s=n.getoAuth(),l=s.member_id,d=[],m="SELECT emailid ,memberId ,categoryId ,newsletterSignupId ,subject ,fromEmail  ,createdDate ,emailSendingDate,imagePath ,statusName ,pointforSave ,pointforNotInterest ,pointforFeedback ,pointforShare ,opened FROM newsletterEmail WHERE memberId = (?) AND statusName = (?)  AND categoryId=(?)";return o.execute(db,m,[l,t,r]).then(function(e){if(e.rows.length>0){for(var t=0;t<e.rows.length;t++){var r=e.rows.item(t);d.push(r)}a=d,i.resolve(a)}else i.resolve(a)},function(e){console.log(e),i.resolve(a)}),i.promise}function q(e){if(!angular.isUndefined(e)){var t=n.getoAuth(),r=t.member_id,i="INSERT INTO ApiFailedLog (memberId ,apiCallType ,dataObject ,created) VALUES (?,?,?,?)";o.execute(db,i,[r,e.apiCallType,e.dataObject,new Date]).then(function(e){console.log("INSERT ID -> "+e.insertId)},function(e){console.log(e)})}}function J(){var e=n.getoAuth(),t=e.member_id,r="DELETE FROM ApiFailedLog WHERE id=(?)",a="SELECT id,memberId ,apiCallType ,dataObject ,created FROM ApiFailedLog WHERE memberId = (?) AND apiCallType = (?)ORDER BY created DESC LIMIT 1";o.execute(db,a,[t,"profile"]).then(function(e){e.rows.length>0&&n.SaveMember(JSON.parse(e.rows.item(0).dataObject)).then(function(t){if(t.isSuccessful){var n=e.rows.item(0).id;o.execute(db,r,[n]).then(function(){},function(e){console.log(e)})}})},function(e){console.log(e)});var s="SELECT id,memberId ,apiCallType ,dataObject ,created FROM ApiFailedLog WHERE memberId = (?) AND apiCallType = (?)ORDER BY created ";o.execute(db,s,[t,"sub"]).then(function(e){if(e.rows.length>0)for(var r=0;r<e.rows.length;r++){var n=e.rows.item(r),a=JSON.parse(n.dataObject);if(i.saveMemberSignupList(a.signupIds,a.cId).then(),r==e.rows.length-1){var s="Delete FROM ApiFailedLog WHERE memberId = (?) AND apiCallType = (?)";o.execute(db,s,[t,"sub"]).then(function(e){},function(e){console.log(e)})}}},function(e){console.log(e)});var l="SELECT id,memberId ,apiCallType ,dataObject ,created FROM ApiFailedLog WHERE memberId = (?) AND apiCallType = (?)",d=[];o.execute(db,l,[t,"emailStatusChange"]).then(function(e){if(e.rows.length>0){for(var r=0;r<e.rows.length;r++){var n=JSON.parse(e.rows.item(r).dataObject);d.push({Emailid:n.Emailid,StatusId:n.StatusId})}if(d.length>0){var a={MemberId:t,EmailStatusList:d};i.batchUpdateMemberEmailStatus(a).then(function(e){if(e.isSuccessful){var r="DELETE FROM ApiFailedLog WHERE memberId = (?) AND apiCallType = (?)";o.execute(db,r,[t,"emailStatusChange"]).then(function(e){},function(e){console.log(e)})}})}}},function(e){console.log(e)});o.execute(db,l,[t,"notInterested"]).then(function(e){if(e.rows.length>0)for(var r=0;r<e.rows.length;r++){var n=e.rows.item(r);if(i.saveNewsletterAsUnsub(n.dataObject).then(function(e){}),r==e.rows.length-1){var a="Delete FROM ApiFailedLog WHERE memberId = (?) AND apiCallType = (?)";o.execute(db,a,[t,"notInterested"]).then(function(e){},function(e){console.log(e)})}}},function(e){console.log(e)})}function K(){if(n.isNetworkAvailable()){var e=n.getoAuth();if(null!=e&&!angular.isUndefined(e)){var t=e.member_id,r=0,i="SELECT count(*) as total  FROM ApiFailedLog WHERE memberId = (?)";o.execute(db,i,[t]).then(function(e){if(e.rows.length>0&&(r=e.rows.item(0).total,!angular.isUndefined(localStorage.oAuth)&&localStorage.oAuth.length>0)){var t=JSON.parse(localStorage.oAuth);t.access_token==t.member_id?n.login(t.email,t.password).then(function(){r>0&&J()}):r>0&&J()}})}}}d(),K();return{setMemberTODeviceDB:m,getMemberFromDeviceDB:c,updateMemberToDeviceDB:u,getNewsLetterCategoriesFromDeviceDB:v,getNewsletterFromDeviceDB:N,getNewslettersFromDeviceDB:S,insertMemberNewsletterToDeviceDB:R,updateMemberNewsletterToDeviceDB:A,getMemberNewslettersFromDeviceDB:x,getMemberNewsletterCategoryIdsFromDeviceDB:O,syncMemberEmailsToDeviceDB:C,getEmailsFromDeviceDB:M,updateEmailToDeviceDB:U,getTrendingEmailFromDeviceDB:_,getEmailDetailfromDeviceDB:k,getCategoryFromDeviceDB:I,saveNewsletterAsUnsubFromDeviceDb:j,initNewsletterCategory:p,login:E,InsertIntoApiFailedLog:q,ProcessApiFailedLog:J,getEmailCount:$,getEmailBodyfromDeviceDB:P,search:X,getNewEmailsFromDeviceDB:B,markAsRead:Y,veirfySubscribed:L,getEmailsByCategory:V}}angular.module("newsletterApp").factory("sqlLiteService",sqlLiteService),sqlLiteService.$inject=["$q","$rootScope","envVariables","$cordovaSQLite","authService","dataService","$cordovaNetwork","$filter","CacheFactory"];
!function(){"use strict";function e(e,o,a,t,n,l,i,r,s){function u(){angular.isUndefined(localStorage.showTutorialOverlay)&&(m.showTutorialOverlay=!0),a.getNewsLetterCategoriesFromDeviceDB(!1).then(function(e){null==e||angular.isUndefined(e.categories)?console.log("No data is available"):m.category=e.categories})}function d(){i(function(){m.showUndoInbox=!1,m.undoEmailIdInbox=0},3e3)}o.broadcastNetworkAvailability();var m=this;m.selectedCategory="",m.category=[],m.showSearchTextBox=!1,m.searchText,m.activeslide=1,m.inboxItems=[],m.swipedToSave=[],m.pageNumber=0,m.moreItemsAvailable=!1,m.showUndoInbox=!1,m.showUndoInbox=!1,m.undoEmail={},m.undoEmailIdInbox=0,m.undoMessageInbox="",m.showTutorialOverlay=!1,m.showloader=!0,m.showDefaultImage=!1,m.canrefresh=!0,m.viewMoreLoader=!1,m.UnreadCount=0,m.lastId=0,m.pullRefreshText=o.isNetworkAvailable()?"Pull to refresh...":"Network unavailable",m.canrefresh=!0,u(),m.populateNewsletters=function(){m.inboxItems.length<1&&(m.moreItemsAvailable=!0),m.pageNumber=m.pageNumber+1,m.moreItemsAvailable&&(m.pageNumber>1&&(m.viewMoreLoader=!0),a.getEmailsFromDeviceDB("Save",m.pageNumber,m.lastId).then(function(e){if(m.moreItemsAvailable=!1,!angular.isUndefined(e)&&null!=e&&e.length){m.showDefaultImage=!1;var o=1;angular.forEach(e,function(e){m.inboxItems.push(e),1==m.inboxItems.length&&(m.lastId=e.emailid),o==m.inboxItems.length&&(m.viewMoreLoader=!1,m.showloader=!1,m.showDefaultImage=!1),o++}),m.moreItemsAvailable=!0}else m.moreItemsAvailable=!1,m.viewMoreLoader=!1,m.showloader=!1,m.inboxItems.length<1&&(m.showDefaultImage=!0);l.$broadcast("scroll.infiniteScrollComplete")},function(e){l.$broadcast("scroll.infiniteScrollComplete"),m.showloader=!1,m.viewMoreLoader=!1,m.showloader=!1}))},l.$on("$ionicView.enter",function(){m.lastId=0,m.moreItemsAvailable=!0,m.pageNumber=0,m.inboxItems=[],m.selectedCategory="",m.populateNewsletters()}),m.onSlide=function(o,t){m.undoEmailIdInbox=o;var l=0;0===t?(l=1,m.undoMessageInbox="1 item moved to inbox."):(l=3,m.undoMessageInbox="1 item deleted."),n.canDragContent(!1),a.updateEmailToDeviceDB(o,l).then(function(t){t&&(e.updateEmail(o,l).then(function(e){if(!e.isSuccessful&&e.saveToApiLog){var t={Emailid:o,StatusId:l},n={apiCallType:"emailStatusChange",dataObject:JSON.stringify(t)};a.InsertIntoApiFailedLog(n)}}),m.removeEmail(o))}),m.showUndoInbox=!0,d()},m.removeEmail=function(e){var o=t("filter")(m.inboxItems,{emailid:e},!0);if(o.length){var a=m.inboxItems.indexOf(o[0]);m.inboxItems.splice(a,1),m.undoEmail=o[0]}m.inboxItems.length<10&&m.populateNewsletters(),m.inboxItems.length<1&&(m.showDefaultImage=!0)},m.doRefresh=function(){m.canrefresh&&(m.canrefresh=!1,m.lastId>0?a.getNewEmailsFromDeviceDB("Save",m.lastId).then(function(e){!angular.isUndefined(e)&&null!=e&&e.length?(angular.forEach(e,function(e){m.inboxItems.unshift(e)}),m.showDefaultImage=!1,m.canrefresh=!0,l.$broadcast("scroll.refreshComplete")):(m.canrefresh=!0,l.$broadcast("scroll.refreshComplete"))},function(e){m.canrefresh=!0,l.$broadcast("scroll.refreshComplete")}):(m.pageNumber=0,m.populateNewsletters(),m.canrefresh=!0,l.$broadcast("scroll.refreshComplete")))},m.categoryChanged=function(){m.showDefaultImage=!1;var e=m.selectedCategory;e.length>0?(m.pageNumber=0,m.inboxItems=[],m.moreItemsAvailable=!1,m.lastId=0,a.getEmailsByCategory("Save",e).then(function(e){!angular.isUndefined(e)&&null!=e&&e.length?angular.forEach(e,function(e){m.inboxItems.push(e)}):m.showDefaultImage=!0})):(m.lastId=0,m.moreItemsAvailable=!0,m.pageNumber=0,m.inboxItems=[],m.populateNewsletters())},m.undoPreviousActionInbox=function(){m.showUndoInbox=!1,m.undoEmailIdInbox>0&&a.updateEmailToDeviceDB(m.undoEmailIdInbox,2).then(function(o){e.updateEmail(m.undoEmailIdInbox,2).then(function(e){m.inboxItems.push(m.undoEmail),m.showUndoInbox=!1,m.undoEmailIdInbox=0,m.showDefaultImage=!1})})},m.gotosearch=function(){r.nextViewOptions({historyRoot:!0}),s.transitionTo("app.search",{status:"Save"})},l.$on("UnreadCountSaved",function(e,o){m.UnreadCount=o}),m.updateEmailFromModal=function(e){angular.forEach(e,function(e){m.removeEmail(e)})},m.updateCssFromModal=function(e){angular.forEach(e,function(e){var o="email"+e,a=document.getElementById(o);null!=a&&(a.style.backgroundColor="#eee")})}}angular.module("newsletterApp").controller("savedController",e),e.$inject=["dataService","authService","sqlLiteService","$filter","$ionicSideMenuDelegate","$scope","$timeout","$ionicHistory","$state"]}();
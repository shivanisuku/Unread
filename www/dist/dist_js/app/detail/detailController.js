!function(){"use strict";function e(e,i,a,o,t,l,n,s,d,m,c,r,u,p,v,f){function S(i){s(function(){i==e.undoEmailId&&(e.showUndo=!1,e.undoStatus=0,e.undoEmailId=0)},4e3)}e.emailSlide=[],e.email,e.prevEmail,e.openFeedback=!1,e.share=!1,e.emailStatus=!1,e.showUndo=!1,e.undoStatus=0,e.undoEmailId=0,e.undoMessage="",e.showNotInterestedMessage=!1,e.showloader_det=!0,e.slideAnimationMessage="",e.modalOpened=!0,e.subscribed=!0,e.feedback={},e.feedbackError=!1,e.showTutorialOverlay=!1,e.modifiedEmails=[],e.readEmails=[],e.canAnimateSlide=!0,e.showEmailDSMAction=!0,e.initZoom=.6,e.openPopover=function(i){e.popover.show(i)},e.closePopover=function(){e.popover.hide()},t.fromTemplateUrl("app/detail/detail.html",{scope:e,animation:"fade-in"}).then(function(i){e.modal=i}),e.openModal=function(i,a){e.readEmails.push(i),e.modalOpened=!0,e.emailStatus=a,o.getEmailDetailfromDeviceDB(i,a).then(function(i){e.prevEmail=i.prevEmail,e.email=i.email,e.emailSlide=[],e.emailSlide.push({email:e.email,prevEmail:e.prevEmail}),console.log(e.emailSlide),e.PopulatePopOverTemplate(),e.showloader_det=!1,o.markAsRead(e.email.emailid,e.emailStatus),angular.isUndefined(localStorage.showTutorialOverlayDetail)&&(e.showTutorialOverlay=!0)}),e.modal.show()},e.closeModal=function(){e.modifiedEmails.length&&e.$parent.vm.updateEmailFromModal(e.modifiedEmails),"Trending"!=e.emailStatus&&e.$parent.vm.updateCssFromModal(e.readEmails),e.modalOpened=!1,e.email="",e.prevEmail="",e.emailSlide=[],e.modal.hide()},e.$on("$destroy",function(){e.modal.remove()}),e.toogleShare=function(){e.share=!e.share},e.emailDSMAction=function(a,t,l){e.showEmailDSMAction=!1,o.updateEmailToDeviceDB(a,t).then(function(n){n&&(e.undoStatus=0,e.undoEmailId=e.email.emailid,e.showUndo=!1,"Save"===e.emailStatus&&(e.undoStatus=2),"Inbox"===e.emailStatus&&(e.undoStatus=1),e.undoMessage="",e.undoMessage=2===t?"1 item moved to saved.":3===t?"1 item deleted.":"1 item moved to Inbox",e.modifiedEmails.indexOf(a)<0&&e.modifiedEmails.push(a),i.updateEmail(a,t).then(function(e){if(!e.isSuccessful&&e.saveToApiLog){var i={Emailid:a,StatusId:t},l={apiCallType:"emailStatusChange",dataObject:JSON.stringify(i)};o.InsertIntoApiFailedLog(l)}}),e.openFeedback=!1,e.share=!1,e.getNextEmail(l))})},e.notInterested=function(a){var a=e.email.newsletterSignupId;e.openFeedback=!1,e.share=!1,o.saveNewsletterAsUnsubFromDeviceDb(a,e.email.categoryId).then(function(){i.saveNewsletterAsUnsub(a).then(function(e){if(!e.isSuccessful){var i=({Emailid:a,StatusId:status},{apiCallType:"notInterested",dataObject:a.toString()});o.InsertIntoApiFailedLog(i)}}),e.closePopover(),e.showNotInterestedMessage=!0,s(function(){e.showNotInterestedMessage=!1},5e3)})},e.sendFeedback=function(){e.closePopover();var a=new Date,o=e.email.newsletterSignupId+"#[email] has send feedback for [brand]  "+e.email.subject+".  Feedback send on "+a.toLocaleDateString(),t=' <label ><div class="input-label"> Description</div><textarea rows="3" class="popup-feedback-textarea" name="description" placeholder="Please enter your feedback or comment."  id="description"  ng-model="feedback.Description" ></textarea></label><div class="form-error" ng-if="feedbackError">Please enter the description.</div>';c.confirm({template:t,title:"Feedback",scope:e,buttons:[{text:"Cancel"},{text:"<b>Submit</b>",type:"button-positive",onTap:function(a){if(e.feedback.Description){e.feedbackError=!1;var t={Type:"Feedback for particular email",Description:e.feedback.Description,Subject:o};console.log(t),i.sendFeedback(t).then(function(e){e.isSuccessful})}else e.feedbackError=!0,a.preventDefault()}}]}).then(function(e){})},e.getNextEmail=function(i){var a=null!=e.prevEmail?e.prevEmail.emailid:0;a>0?(e.email=e.prevEmail,e.emailSlide=[],e.emailSlide.push({email:e.prevEmail,prevEmail:e.prevEmail}),console.log(e.emailSlide),e.openFeedback=!1,e.share=!1,o.getEmailDetailfromDeviceDB(a,e.emailStatus).then(function(i){e.prevEmail=i.prevEmail,e.emailSlide[0].prevEmail=i.prevEmail,console.log(e.emailSlide),o.markAsRead(e.email.emailid,e.emailStatus),e.PopulatePopOverTemplate(),"Trending"!=e.emailStatus&&(e.showUndo=!0,S(e.undoEmailId))}),e.readEmails.push(a)):(S(e.email.emailid),s(function(){e.closeModal()},3e3))},e.onSlide=function(i){e.slideAnimationMessage="",0===i&&"Inbox"===e.email.statusName?e.emailDSMAction(e.email.emailid,2,i):2===i&&"Trending"!=e.email.statusName?e.emailDSMAction(e.email.emailid,3,i):0===i&&"Save"===e.email.statusName?e.emailDSMAction(e.email.emailid,1,i):e.getNextEmail(i)},e.undoPreviousAction=function(){e.showUndo=!1,e.undoEmailId>0&&e.undoStatus>0&&(e.showEmailDSMAction=!1,o.updateEmailToDeviceDB(e.undoEmailId,e.undoStatus).then(function(a){i.updateEmail(e.undoEmailId,e.undoStatus).then(function(e){}),e.undoStatus=0,o.getEmailDetailfromDeviceDB(e.undoEmailId,e.emailStatus).then(function(i){null!=i.prevEmail&&(e.prevEmail=i.prevEmail),e.email=i.email,e.emailSlide=[],e.emailSlide.push({email:e.email,prevEmail:e.prevEmail}),e.modifiedEmails.indexOf(e.undoEmailId)>-1&&e.modifiedEmails.splice(e.modifiedEmails.indexOf(e.undoEmailId),1),e.showEmailDSMAction=!0})}))},e.PopulatePopOverTemplate=function(){var i='<ion-popover-view class="fit"> <ion-content> <div class="list"><div ng-click="sendFeedback()" class="item item-icon-left"><i class="icon ion-reply-all"></i> Feedback</div>';"Trending"!=e.emailStatus&&(i+=' <div ng-click="notInterested()" class="item item-icon-left"> <i class="icon ion-thumbsdown"></i>Unsubscribe</div>'),"Save"===e.emailStatus&&(i=i+'<div  ng - click = "emailDSMAction('+e.email.emailid,'1)" class="item item-icon-left"><i class = "icon ion-email" > < / i >Move to Inbox'),i+="</div> </ion-content></ion-popover-view>",e.popover=d.fromTemplate(i,{scope:e}),e.closePopover=function(){e.popover.hide()},e.$on("$destroy",function(){e.popover.remove()})},e.animateSlide=function(i){if(e.canAnimateSlide&&"Trending"!=e.emailStatus)if(e.showSlideLeftAnimation=!0,1==i){var a="Save"==e.emailStatus?"Inbox":"Save",o='<div class="animated fadeIn swipe-overlay-save"><div  class="row inbox-save-swipe"><div class="col text-left"><span class="swipe-icon-box"><i class="icon ion-star custom-icon"></i>'+a+"</span></div></div></div>";e.slideAnimationMessage=l.trustAsHtml(o)}else 2==i?e.slideAnimationMessage=l.trustAsHtml('<div  class="animated fadeIn swipe-overlay-delete"><div  class="row inbox-delete-swipe">   <div class="col text-right"><span class="swipe-icon-box"><i class="icon ion-trash-b custom-icon"></i>Delete</span></div></div></div>'):e.slideAnimationMessage=""},e.closeTutorialOverlay=function(){e.showTutorialOverlay=!1,localStorage.showTutorialOverlayDetail="false"},e.zoomTap=function(){e.slideAnimationMessage=""},e.showEmailDSMActionFn=function(){e.showEmailDSMAction=!0},m.onHardwareBackButton(function(){e.modifiedEmails.length&&e.$parent.vm.updateEmailFromModal(e.modifiedEmails),"Trending"!=e.emailStatus&&e.$parent.vm.updateCssFromModal(e.readEmails),e.modalOpened=!1,e.email="",e.prevEmail="",e.emailSlide=[],e.modal.hide()},400)}angular.module("newsletterApp").controller("detailController",e),e.$inject=["$scope","dataService","authService","sqlLiteService","$ionicModal","$sce","$window","$timeout","$ionicPopover","$ionicPlatform","$ionicPopup","$rootScope","$ionicHistory","$state","$ionicSlideBoxDelegate","$ionicScrollDelegate"]}();